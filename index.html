<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MACRO TERMINAL Â· Global Markets Dashboard</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    html,body,#root{min-height:100vh;background:#060810;}
    ::-webkit-scrollbar{width:4px;height:4px;}
    ::-webkit-scrollbar-track{background:#060810;}
    ::-webkit-scrollbar-thumb{background:#1c2333;border-radius:2px;}
    input[type=range]{-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;}
    input[type=range]::-webkit-slider-runnable-track{background:#1c2333;border-radius:4px;height:4px;}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#00d4ff;margin-top:-5px;box-shadow:0 0 6px #00d4ff88;}
    input[type=range].gold::-webkit-slider-thumb{background:#f0b429;box-shadow:0 0 6px #f0b42988;}
    input[type=range].gold::-webkit-slider-runnable-track{background:linear-gradient(90deg,#1c2333,#f0b42966);}
    .flow-tab-btn{padding:4px 14px;border-radius:4px;font-size:10px;font-family:'JetBrains Mono',monospace;cursor:pointer;transition:all .2s;border:1px solid #1c2333;background:transparent;color:#5a6a7a;}
    .flow-tab-btn.active{border-color:#00d4ff;background:#00d4ff18;color:#00d4ff;}
    .flow-tab-btn:hover{opacity:.85;}
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    const C = {
      bg:"#060810", panel:"#0d1117", border:"#1c2333",
      accent:"#00d4ff", gold:"#f0b429", green:"#00e676",
      red:"#ff1744", purple:"#bb86fc", text:"#e0e6f0",
      muted:"#5a6a7a", dim:"#3a4a5a",
    };

    const MONTHS = ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];

    const EDGES_MONTHLY = [
      { from:"bonds",  to:"us_eq",  label:"ê¸ˆë¦¬ì¸í•˜ ê¸°ëŒ€", tier:"xl", amounts:[460,440,400,370,320,280,260,290,340,390,430,480] },
      { from:"usd",    to:"crypto", label:"ë¦¬ìŠ¤í¬ì˜¨", tier:"xl", amounts:[350,380,420,390,340,280,230,260,310,360,400,440] },
      { from:"asia",   to:"us_eq",  label:"ë‹¬ëŸ¬ ê°•ì„¸", tier:"lg", amounts:[300,290,270,250,230,200,190,210,250,270,290,310] },
      { from:"usd",    to:"us_eq",  label:"AI ë¶", tier:"lg", amounts:[240,260,290,310,330,300,270,280,310,340,320,290] },
      { from:"eu_eq",  to:"us_eq",  label:"ì„±ì¥ ê²©ì°¨", tier:"lg", amounts:[200,195,185,175,165,150,140,155,170,185,195,205] },
      { from:"asia",   to:"gold",   label:"ì§€ì •í•™ í—¤ì§€", tier:"lg", amounts:[160,170,190,210,200,185,175,180,200,220,195,170] },
      { from:"eu_eq",  to:"bonds",  label:"ECB ì™„í™”", tier:"md", amounts:[150,145,135,125,120,115,110,115,125,135,145,155] },
      { from:"bonds",  to:"usd",    label:"ì•ˆì „ìì‚°", tier:"md", amounts:[140,135,120,110,100,120,140,130,115,105,120,145] },
      { from:"crypto", to:"us_eq",  label:"ê¸°ê´€ ìˆœí™˜", tier:"md", amounts:[100,110,130,150,140,120,100,110,130,160,170,150] },
      { from:"kr_eq",  to:"usd",    label:"ì™¸êµ­ì¸ ìˆœë§¤ë„", tier:"sm", amounts:[90,85,80,75,70,65,60,65,75,80,85,90] },
      { from:"usd",    to:"gold",   label:"ì¸í”Œë ˆ í—¤ì§€", tier:"sm", amounts:[70,72,75,80,85,90,88,82,78,74,70,68] },
      { from:"comm",   to:"asia",   label:"ì›ìì¬ ìˆ˜ìš”", tier:"sm", amounts:[60,62,65,70,72,68,64,66,70,72,68,62] },
    ];

    const NODES = [
      { id:"us_eq",  label:"ë¯¸êµ­ ì£¼ì‹",     en:"US Equities",    x:0.75, y:0.15, r:64, color:"#00d4ff" },
      { id:"eu_eq",  label:"ìœ ëŸ½ ì£¼ì‹",     en:"EU Equities",    x:0.20, y:0.20, r:46, color:"#7c6af5" },
      { id:"asia",   label:"ì•„ì‹œì•„ ì‹ í¥êµ­", en:"EM Asia",        x:0.10, y:0.55, r:50, color:"#f0b429" },
      { id:"kr_eq",  label:"í•œêµ­ ì£¼ì‹",     en:"KR Equities",    x:0.26, y:0.80, r:36, color:"#ff9800" },
      { id:"bonds",  label:"ì±„ê¶Œ",          en:"Bonds",          x:0.50, y:0.12, r:52, color:"#4caf50" },
      { id:"gold",   label:"ê¸ˆ",            en:"Gold",           x:0.84, y:0.62, r:40, color:"#ffd700" },
      { id:"crypto", label:"ì•”í˜¸í™”í",      en:"Crypto",         x:0.62, y:0.82, r:48, color:"#ff6b6b" },
      { id:"usd",    label:"ë‹¬ëŸ¬ í˜„ê¸ˆ",     en:"Cash/USD",       x:0.50, y:0.50, r:44, color:"#00e676" },
      { id:"comm",   label:"ì›ìì¬",        en:"Commodities",    x:0.16, y:0.36, r:34, color:"#ff7043" },
    ];

    const TIER_CFG = {
      xl:{ strokeW:4.5, maxR:8,   count:14, labelSize:12, badge:"XL" },
      lg:{ strokeW:3.0, maxR:5.5, count:9,  labelSize:11, badge:"LG" },
      md:{ strokeW:1.8, maxR:3.5, count:6,  labelSize:10, badge:"MD" },
      sm:{ strokeW:1.0, maxR:2.2, count:4,  labelSize:9,  badge:"SM" },
    };

    const TIER_COLORS = { xl:"#ff4060", lg:"#ff9800", md:"#f0b429", sm:"#00e676" };

    const RATES = [
      { name:"US Fed",  value:4.25, prev:4.50, term:"Policy" },
      { name:"US 2Y",   value:4.18, prev:4.22, term:"Short" },
      { name:"US 10Y",  value:4.52, prev:4.48, term:"Long" },
      { name:"US 30Y",  value:4.73, prev:4.69, term:"Long" },
      { name:"ECB",     value:2.65, prev:2.90, term:"Policy" },
      { name:"BOJ",     value:0.50, prev:0.25, term:"Policy" },
      { name:"BOK",     value:2.75, prev:3.00, term:"Policy" },
    ];

    const JARVIS_INSIGHT = {
      date: "2026-02-28",
      macro: { vix: 14.5, fearGreed: 42, us10y: 4.25, usdkrw: 1325 },
      summary: "ì‹œì¥ ê³µí¬(VIX)ëŠ” ë‚®ìœ¼ë‚˜ ì‹¬ë¦¬(CNN)ëŠ” Neutral ìƒíƒœì…ë‹ˆë‹¤. í™˜ìœ¨ ì•ˆì •í™”ë¡œ ì½”ìŠ¤í”¼ ë°˜ë“± ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.",
      strategy: "KOSPI/ê¸ˆ ë¹„ì¤‘ ìœ ì§€. ë¹„íŠ¸ì½”ì¸ 67k ëŒíŒŒ ì‹œ í˜„ê¸ˆ ë¹„ì¤‘ 10% ì¶”ê°€ íˆ¬ì… ê¶Œê³ ."
    };

    function TV({ type, opts, height }) {
      const ref = useRef(null);
      const uid = useRef("tv_" + Math.random().toString(36).slice(2));
      useEffect(() => {
        if (!ref.current) return;
        ref.current.innerHTML = "";
        const wrap = document.createElement("div");
        wrap.id = uid.current;
        ref.current.appendChild(wrap);
        const s = document.createElement("script");
        s.src = `https://s3.tradingview.com/external-embedding/embed-widget-${type}.js`;
        s.async = true;
        s.innerHTML = JSON.stringify({...opts, container_id:uid.current, width:"100%", height, colorTheme:"dark", locale:"kr", isTransparent:true});
        wrap.appendChild(s);
        return () => { if (ref.current) ref.current.innerHTML = ""; };
      }, []);
      return <div ref={ref} style={{width:"100%",height,overflow:"hidden"}} />;
    }

    function Particle({ from, to, speed, color, maxR, opacity }) {
      const prog = useRef(Math.random());
      const [p, setP] = useState(prog.current);
      useEffect(() => {
        let raf, last = performance.now();
        const tick = (now) => {
          prog.current = (prog.current + (now - last) / 1000 * speed) % 1;
          last = now; setP(prog.current);
          raf = requestAnimationFrame(tick);
        };
        raf = requestAnimationFrame(tick);
        return () => cancelAnimationFrame(raf);
      }, [speed]);
      const x = from.x + (to.x - from.x) * p;
      const y = from.y + (to.y - from.y) * p;
      const r = (maxR||4) * (0.4 + (1 - Math.abs(p - 0.5)*2) * 0.6);
      return <circle cx={`${x*100}%`} cy={`${y*100}%`} r={r} fill={color} opacity={(opacity||0.65)*(0.4+p*0.6)} />;
    }

    function Sparkline({ data, color, width=80, height=28 }) {
      if (!data || data.length < 2) return null;
      const min = Math.min(...data), max = Math.max(...data);
      const range = max - min || 1;
      const pts = data.map((v,i) => {
        const x = (i / (data.length-1)) * width;
        const y = height - ((v - min) / range) * (height - 4) - 2;
        return `${x},${y}`;
      }).join(" ");
      const last = data[data.length-1], first = data[0];
      const lineColor = last >= first ? "#00e676" : "#ff1744";
      return (
        <svg width={width} height={height} style={{display:"block"}}>
          <polyline points={pts} fill="none" stroke={lineColor} strokeWidth="1.5" strokeLinejoin="round" strokeLinecap="round"/>
        </svg>
      );
    }

    function CapitalFlowHero() {
      const [monthIdx, setMonthIdx] = useState(new Date().getMonth());
      const [playing, setPlaying] = useState(false);
      const [speed, setSpeed] = useState(1.0);
      const [flowTab, setFlowTab] = useState("map");
      const [hoveredEdge, setHoveredEdge] = useState(null);
      const [tick, setTick] = useState(0);
      const playRef = useRef(null);

      useEffect(() => {
        if (playing) {
          playRef.current = setInterval(() => {
            setMonthIdx(m => (m + 1) % 12);
          }, Math.round(1200 / speed));
        }
        return () => clearInterval(playRef.current);
      }, [playing, speed]);

      useEffect(() => {
        const iv = setInterval(() => setTick(t => t+1), 60);
        return () => clearInterval(iv);
      }, []);

      const edges = EDGES_MONTHLY.map(e => ({
        ...e,
        amount: e.amounts[monthIdx],
        w: e.amounts[monthIdx] / 480,
      }));

      const particles = useRef([]);
      useEffect(() => {
        particles.current = edges.flatMap(e => {
          const cfg = TIER_CFG[e.tier];
          const cnt = Math.max(2, Math.round(cfg.count * e.w * 1.5));
          return Array.from({length: cnt}, (_, i) => ({
            id: `${e.from}${e.to}${i}${monthIdx}`,
            from: e.from, to: e.to,
            speed: (0.05 + Math.random() * 0.10) * speed * (0.5 + e.w * 0.8),
            color: NODES.find(n=>n.id===e.from)?.color || "#fff",
            maxR: cfg.maxR * (0.6 + e.w * 0.6),
            opacity: 0.5 + e.w * 0.45,
          }));
        });
      }, [monthIdx, speed, edges]);

      const totalFlow = edges.reduce((s,e)=>s+e.amount, 0);
      const maxAmt = Math.max(...edges.map(e=>e.amount));

      return (
        <div style={{background:C.panel, border:`1px solid ${C.border}`, borderRadius:8, overflow:"hidden"}}>
          <div style={{padding:"10px 16px", borderBottom:`1px solid ${C.border}`, display:"flex", justifyContent:"space-between", alignItems:"center"}}>
            <div style={{display:"flex", alignItems:"center", gap:12}}>
              <div style={{width:3, height:20, background:C.accent, borderRadius:2}}/>
              <span style={{fontFamily:"Space Grotesk", fontSize:13, fontWeight:700, color:C.accent, letterSpacing:"0.08em"}}>CAPITAL FLOW MONITOR</span>
              <span style={{fontFamily:"JetBrains Mono", fontSize:10, color:C.gold}}>ì›”ê°„ ê¸€ë¡œë²Œ ìê¸ˆ ì´ë™ ì‹œê°í™”</span>
            </div>
            <div style={{display:"flex", gap:6}}>
              {["map","chart","table"].map(t=>(
                <button key={t} className={`flow-tab-btn${flowTab===t?" active":""}`} onClick={()=>setFlowTab(t)}>
                  {t==="map"?"ğŸ—º FLOW MAP":t==="chart"?"ğŸ“Š MONTHLY CHART":"ğŸ“‹ TABLE"}
                </button>
              ))}
            </div>
          </div>

          <div style={{padding:"10px 16px", background:"#080d18", borderBottom:`1px solid ${C.border}`, display:"flex", alignItems:"center", gap:16}}>
            <button onClick={()=>setPlaying(p=>!p)} style={{ width:36, height:36, borderRadius:"50%", border:`1px solid ${playing?C.accent:C.border}`, background:playing?C.accent+"22":"transparent", color:playing?C.accent:C.muted, fontSize:14, cursor:"pointer", display:"flex", alignItems:"center", justifyContent:"center", }}>
              {playing ? "â¸" : "â–¶"}
            </button>
            <div style={{flex:1, display:"flex", flexDirection:"column", gap:4}}>
              <div style={{display:"flex", justifyContent:"space-between", marginBottom:2}}>
                {MONTHS.map((m,i)=>(
                  <span key={i} onClick={()=>{setMonthIdx(i);setPlaying(false);}} style={{fontSize:9, color:i===monthIdx?C.accent:C.muted, fontFamily:"JetBrains Mono", fontWeight:i===monthIdx?700:400, cursor:"pointer", padding:"0 2px", borderBottom:i===monthIdx?`1px solid ${C.accent}`:"none", }}>
                    {m.replace("ì›”","")}
                  </span>
                ))}
              </div>
              <input type="range" min="0" max="11" value={monthIdx} onChange={e=>{setMonthIdx(+e.target.value); setPlaying(false);}} style={{width:"100%", accentColor:C.accent}} />
            </div>
            <div style={{textAlign:"center", minWidth:80}}>
              <div style={{fontFamily:"Space Grotesk", fontSize:18, fontWeight:700, color:C.accent}}>
                2025ë…„ {MONTHS[monthIdx]}
              </div>
              <div style={{fontSize:9, color:C.muted, fontFamily:"JetBrains Mono"}}>
                ì´ ì´ë™ <span style={{color:C.gold}}>${(totalFlow/1000).toFixed(1)}T</span>
              </div>
            </div>
            <div style={{display:"flex", flexDirection:"column", gap:4, minWidth:110}}>
              <div style={{display:"flex", justifyContent:"space-between"}}>
                <span style={{fontSize:9, color:C.muted, fontFamily:"JetBrains Mono"}}>ì¬ìƒ ì†ë„</span>
                <span style={{fontSize:9, color:C.gold, fontFamily:"JetBrains Mono", fontWeight:700}}>{speed.toFixed(1)}x</span>
              </div>
              <input type="range" className="gold" min="0.3" max="4" step="0.1" value={speed} onChange={e=>setSpeed(+e.target.value)} style={{width:"100%", accentColor:C.gold}} />
            </div>
          </div>

          <div style={{display:"flex", height:520}}>
            <div style={{flex:1, position:"relative"}}>
              {flowTab === "map" && (
                <svg width="100%" height="100%" style={{display:"block"}}>
                  <defs>
                    <filter id="glow2"><feGaussianBlur stdDeviation="4" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                    <filter id="glow-xl"><feGaussianBlur stdDeviation="7" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                  </defs>
                  {edges.map(e => {
                    const f = NODES.find(n=>n.id===e.from), t = NODES.find(n=>n.id===e.to);
                    if (!f||!t) return null;
                    const cfg = TIER_CFG[e.tier];
                    const tc = TIER_COLORS[e.tier];
                    const x1=f.x*100, y1=f.y*100, x2=t.x*100, y2=t.y*100;
                    const mx=(x1+x2)/2+(y2-y1)*0.18, my=(y1+y2)/2-(x2-x1)*0.18;
                    const d=`M${x1}% ${y1}% Q${mx}% ${my}% ${x2}% ${y2}%`;
                    const isHovered = hoveredEdge === `${e.from}-${e.to}`;
                    const sw = cfg.strokeW * (0.5 + e.w * 1.2) * (isHovered ? 1.8 : 1);
                    return (
                      <g key={`${e.from}-${e.to}`} onMouseEnter={()=>setHoveredEdge(`${e.from}-${e.to}`)} onMouseLeave={()=>setHoveredEdge(null)} style={{cursor:"pointer"}}>
                        {e.tier==="xl" && <path d={d} stroke={tc} strokeWidth={sw*3} strokeOpacity={0.07} fill="none" filter="url(#glow-xl)"/>}
                        {e.tier==="lg" && <path d={d} stroke={tc} strokeWidth={sw*2} strokeOpacity={0.06} fill="none" filter="url(#glow2)"/>}
                        <path d={d} stroke={isHovered?tc:f.color} strokeWidth={sw} strokeOpacity={isHovered?0.95:0.3+e.w*0.45} fill="none" strokeDasharray={e.tier==="xl"?"none":e.tier==="lg"?"10 4":"6 6"}/>
                        <text x={`${mx}%`} y={`${my}%`} textAnchor="middle" dy="-7" fill={tc} fontSize={cfg.labelSize} fontWeight="700" fontFamily="JetBrains Mono,monospace" opacity={isHovered?1:0.8} filter={e.tier==="xl"||isHovered?"url(#glow2)":"none"}>
                          ${e.amount}B
                        </text>
                        {isHovered && (
                          <text x={`${mx}%`} y={`${my}%`} textAnchor="middle" dy="6" fill="#fff" fontSize="8" fontFamily="JetBrains Mono,monospace" opacity="0.7"> {e.label} </text>
                        )}
                      </g>
                    );
                  })}
                  {particles.current.map(p => {
                    const f=NODES.find(n=>n.id===p.from), t=NODES.find(n=>n.id===p.to);
                    return f&&t ? <Particle key={p.id} from={f} to={t} speed={p.speed} color={p.color} maxR={p.maxR} opacity={p.opacity}/> : null;
                  })}
                  {NODES.map(nd => {
                    const pulse = Math.sin(tick*0.06+nd.x*8)*0.1+0.9;
                    const inFlow = edges.filter(e=>e.to===nd.id).reduce((s,e)=>s+e.amount,0);
                    const outFlow = edges.filter(e=>e.from===nd.id).reduce((s,e)=>s+e.amount,0);
                    const netFlow = inFlow - outFlow;
                    const netColor = netFlow > 0 ? C.green : netFlow < 0 ? C.red : nd.color;
                    return (
                      <g key={nd.id}>
                        <circle cx={`${nd.x*100}%`} cy={`${nd.y*100}%`} r={nd.r*pulse*1.1} fill={nd.color} opacity="0.03"/>
                        <circle cx={`${nd.x*100}%`} cy={`${nd.y*100}%`} r={nd.r*0.65} fill={nd.color} opacity="0.08" filter="url(#glow2)"/>
                        <circle cx={`${nd.x*100}%`} cy={`${nd.y*100}%`} r={nd.r*0.42} fill={C.panel} stroke={nd.color} strokeWidth="1.8" strokeOpacity="0.8"/>
                        <circle cx={`${nd.x*100}%`} cy={`${nd.y*100}%`} r={nd.r*0.5} fill="none" stroke={netColor} strokeWidth="2.5" strokeOpacity="0.35" strokeDasharray={`${Math.abs(netFlow)/10} 5`}/>
                        <text x={`${nd.x*100}%`} y={`${nd.y*100}%`} textAnchor="middle" dy="-4" fill={nd.color} fontSize="10" fontWeight="700" fontFamily="JetBrains Mono,monospace">{nd.label}</text>
                        <text x={`${nd.x*100}%`} y={`${nd.y*100}%`} textAnchor="middle" dy="6" fill={nd.color} fontSize="7.5" opacity="0.55" fontFamily="JetBrains Mono,monospace">{nd.en}</text>
                        <text x={`${nd.x*100}%`} y={`${nd.y*100}%`} textAnchor="middle" dy="16" fill={netColor} fontSize="8" fontWeight="700" fontFamily="JetBrains Mono,monospace" opacity="0.85">
                          {netFlow>0?`+${netFlow}B`:`${netFlow}B`}
                        </text>
                      </g>
                    );
                  })}
                  <g transform="translate(8,8)">
                    <rect x="0" y="0" width="115" height="86" rx="4" fill="#08101a" opacity="0.85"/>
                    <text x="8" y="15" fill={C.muted} fontSize="8" fontFamily="JetBrains Mono,monospace" fontWeight="700">ìê¸ˆ ê·œëª¨ ë²”ë¡€</text>
                    {Object.entries(TIER_CFG).map(([tier,cfg],i)=>{
                      const tc=TIER_COLORS[tier];
                      const ranges={xl:">$300B",lg:"$150-300B",md:"$80-150B",sm:"<$80B"};
                      return (
                        <g key={tier} transform={`translate(8,${22+i*16})`}>
                          <circle r={cfg.maxR*0.65} cx="6" cy="4" fill={tc} opacity="0.85"/>
                          <line x1="14" y1="4" x2="30" y2="4" stroke={tc} strokeWidth={cfg.strokeW*0.7} opacity="0.7"/>
                          <text x="34" y="8" fill={tc} fontSize="9" fontFamily="JetBrains Mono,monospace">{ranges[tier]}</text>
                        </g>
                      );
                    })}
                  </g>
                </svg>
              )}
              {flowTab === "chart" && (
                <div style={{height:520, padding:"16px", overflowY:"auto"}}>
                  <div style={{fontSize:11, color:C.muted, fontFamily:"JetBrains Mono", marginBottom:12, fontWeight:700}}>
                    ì›”ë³„ ìê¸ˆ íë¦„ ì¶”ì´ â€” 12ê°œì›” (ë‹¨ìœ„: $B)
                  </div>
                  <div style={{display:"flex", flexDirection:"column", gap:14}}>
                    {[...edges].sort((a,b)=>b.amount-a.amount).map(e=>{
                      const f=NODES.find(n=>n.id===e.from), t=NODES.find(n=>n.id===e.to);
                      const tc=TIER_COLORS[e.tier];
                      const maxV=Math.max(...e.amounts);
                      return (
                        <div key={`${e.from}-${e.to}`} style={{background:"#080d18", borderRadius:6, padding:"10px 12px", border:`1px solid ${tc}33`}}>
                          <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:8}}>
                            <span style={{fontSize:10, color:f?.color, fontFamily:"JetBrains Mono", fontWeight:700}}>{f?.label} â†’ {t?.label}</span>
                            <span style={{fontSize:9, color:C.muted}}>{e.label}</span>
                          </div>
                          <div style={{display:"flex", alignItems:"flex-end", gap:3, height:48}}>
                            {e.amounts.map((v,i)=>{
                              const barH = (v/maxV)*44;
                              const isCurrent = i===monthIdx;
                              return (
                                <div key={i} style={{flex:1, display:"flex", flexDirection:"column", alignItems:"center", cursor:"pointer"}} onClick={()=>{setMonthIdx(i);setFlowTab("map");}}>
                                  <div style={{ width:"100%", height:barH, background:isCurrent?tc:tc+"55", borderRadius:"2px 2px 0 0", transition:"height 0.3s", boxShadow:isCurrent?`0 0 8px ${tc}88`:"none", }}/>
                                </div>
                              );
                            })}
                          </div>
                          <div style={{display:"flex", justifyContent:"space-between", marginTop:3}}>
                            {MONTHS.map((m,i)=>(
                              <span key={i} style={{flex:1, fontSize:7.5, color:i===monthIdx?tc:C.muted, textAlign:"center", cursor:"pointer"}} onClick={()=>{setMonthIdx(i);setFlowTab("map");}}>{m.replace("ì›”","")}</span>
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
              {flowTab === "table" && (
                <div style={{height:520, overflowY:"auto"}}>
                  <table style={{width:"100%", borderCollapse:"collapse", fontFamily:"JetBrains Mono", fontSize:10}}>
                    <thead>
                      <tr style={{background:"#080d18", borderBottom:`1px solid ${C.border}`}}>
                        <th style={{padding:"8px 12px", textAlign:"left", color:C.muted, fontSize:9, fontWeight:700}}>ìê¸ˆ íë¦„ ê²½ë¡œ</th>
                        {MONTHS.map((m,i)=>(
                          <th key={i} style={{padding:"8px 6px", textAlign:"right", color:i===monthIdx?C.accent:C.muted, fontSize:9, fontWeight:i===monthIdx?700:400, minWidth:48}}> {m.replace("ì›”","")} </th>
                        ))}
                        <th style={{padding:"8px 10px", textAlign:"right", color:C.gold, fontSize:9, fontWeight:700}}>í‰ê· </th>
                      </tr>
                    </thead>
                    <tbody>
                      {[...edges].sort((a,b)=>b.amount-a.amount).map((e,idx)=>{
                        const f=NODES.find(n=>n.id===e.from), t=NODES.find(n=>n.id===e.to);
                        const avg=Math.round(e.amounts.reduce((s,v)=>s+v,0)/12);
                        return (
                          <tr key={`${e.from}-${e.to}`} style={{borderBottom:`1px solid ${C.border}33`, background:idx%2===0?C.panel:C.bg}}>
                            <td style={{padding:"7px 12px"}}>
                              <span style={{color:f?.color, fontWeight:700}}>{f?.label}</span>
                              <span style={{color:C.muted}}> â†’ </span>
                              <span style={{color:t?.color || C.text}}>{t?.label}</span>
                            </td>
                            {e.amounts.map((v,i)=>{
                              const isCurrent=i===monthIdx;
                              const isHigh=v===Math.max(...e.amounts);
                              const isLow=v===Math.min(...e.amounts);
                              return (
                                <td key={i} style={{padding:"7px 6px", textAlign:"right", color:isCurrent?C.accent:isHigh?C.green:isLow?C.red:C.text, background:isCurrent?`${C.accent}11`:"transparent", fontWeight:isCurrent?700:400, cursor:"pointer"}} onClick={()=>setMonthIdx(i)}>
                                  {v}
                                </td>
                              );
                            })}
                            <td style={{padding:"7px 10px", textAlign:"right", color:C.gold, fontWeight:700}}>{avg}</td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              )}
            </div>

            <div style={{width:210, borderLeft:`1px solid ${C.border}`, padding:"12px 10px", overflowY:"auto", background:"#080d18"}}>
              <div style={{fontSize:10, color:C.muted, fontFamily:"JetBrains Mono", marginBottom:10, fontWeight:700, letterSpacing:"0.1em"}}>
                TOP FLOWS Â· {MONTHS[monthIdx]}
              </div>
              {[...edges].sort((a,b)=>b.amount-a.amount).map((e,i)=>{
                const f=NODES.find(n=>n.id===e.from), t=NODES.find(n=>n.id===e.to);
                const tc=TIER_COLORS[e.tier];
                const pct=(e.amount/maxAmt)*100;
                const prevAmt = e.amounts[(monthIdx+11)%12];
                const delta = e.amount - prevAmt;
                return (
                  <div key={`${e.from}-${e.to}`} style={{marginBottom:8, padding:"7px 8px", background:C.panel, borderRadius:5, border:`1px solid ${tc}33`}}>
                    <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:4}}>
                      <span style={{fontSize:9, color:f?.color, fontFamily:"JetBrains Mono", fontWeight:700, maxWidth:130, overflow:"hidden", textOverflow:"ellipsis", whiteSpace:"nowrap"}}>
                        {i+1}. {f?.label}â†’{t?.label}
                      </span>
                      <span style={{fontSize:8, color:tc, fontWeight:700}}>{TIER_CFG[e.tier].badge}</span>
                    </div>
                    <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:4}}>
                      <span style={{fontSize:13, fontWeight:700, color:tc, fontFamily:"JetBrains Mono"}}>${e.amount}B</span>
                      <span style={{fontSize:9, color:delta>=0?C.green:C.red, fontFamily:"JetBrains Mono"}}>
                        {delta>=0?"â–²":"â–¼"}${Math.abs(delta)}B
                      </span>
                    </div>
                    <div style={{height:3, background:C.border, borderRadius:2}}>
                      <div style={{width:`${pct}%`, height:"100%", background:`linear-gradient(90deg,${f?.color}88,${tc})`, borderRadius:2}}/>
                    </div>
                    <div style={{marginTop:4}}>
                      <Sparkline data={e.amounts} color={tc} width={186} height={22}/>
                    </div>
                    <div style={{fontSize:8, color:C.dim, fontFamily:"JetBrains Mono", marginTop:1}}>
                      {e.label}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    function FXWithSparkline() {
      const [rates, setRates] = useState({KRW:1368.5,JPY:149.2,EUR:0.918,GBP:0.782,CNY:7.24,MXN:17.85,AUD:1.562,CAD:1.382});
      const [history, setHistory] = useState({});
      const [live, setLive] = useState(false);
      const genHistory = (base, vol=0.03) => Array.from({length:12},(_,i)=>+(base*(1+(Math.sin(i*0.8+base))*vol)).toFixed(base>10?1:4));
      useEffect(()=>{
        const go = async ()=>{
          try{
            const r=await fetch("https://api.exchangerate-api.com/v4/latest/USD");
            if(!r.ok)return;
            const d=await r.json();
            setRates({KRW:d.rates.KRW,JPY:d.rates.JPY,EUR:d.rates.EUR,GBP:d.rates.GBP,CNY:d.rates.CNY,MXN:d.rates.MXN,AUD:d.rates.AUD,CAD:d.rates.CAD});
            setLive(true);
          }catch{}
        };
        go(); const iv=setInterval(go,60000); return()=>clearInterval(iv);
      },[]);
      useEffect(()=>{
        if(rates.KRW!==1368.5){
          setHistory({
            "USD/KRW": genHistory(rates.KRW, 0.025),
            "USD/JPY": genHistory(rates.JPY, 0.02),
            "EUR/USD": genHistory(1/rates.EUR, 0.018),
            "GBP/USD": genHistory(1/rates.GBP, 0.02),
            "USD/CNY": genHistory(rates.CNY, 0.015),
            "USD/MXN": genHistory(rates.MXN, 0.035),
            "AUD/USD": genHistory(1/rates.AUD, 0.022),
            "USD/CAD": genHistory(rates.CAD, 0.018),
          });
        }
      },[rates]);

      const pairs = [
        {p:"USD/KRW", v:rates.KRW, f:"ğŸ‡ºğŸ‡¸ğŸ‡°ğŸ‡·", decimals:1},
        {p:"USD/JPY", v:rates.JPY, f:"ğŸ‡ºğŸ‡¸ğŸ‡¯ğŸ‡µ", decimals:2},
        {p:"EUR/USD", v:1/rates.EUR, f:"ğŸ‡ªğŸ‡ºğŸ‡ºğŸ‡¸", decimals:4},
        {p:"GBP/USD", v:1/rates.GBP, f:"ğŸ‡¬ğŸ‡§ğŸ‡ºğŸ‡¸", decimals:4},
        {p:"USD/CNY", v:rates.CNY, f:"ğŸ‡ºğŸ‡¸ğŸ‡¨ğŸ‡³", decimals:4},
        {p:"USD/MXN", v:rates.MXN, f:"ğŸ‡ºğŸ‡¸ğŸ‡²ğŸ‡½", decimals:4},
        {p:"AUD/USD", v:1/rates.AUD, f:"ğŸ‡¦ğŸ‡ºğŸ‡ºğŸ‡¸", decimals:4},
        {p:"USD/CAD", v:rates.CAD, f:"ğŸ‡ºğŸ‡¸ğŸ‡¨ğŸ‡¦", decimals:4},
      ];

      return (
        <div style={{padding:"8px 10px", display:"flex", flexDirection:"column", gap:5}}>
          {pairs.map(x=>{
            const spark=history[x.p];
            const last=spark?spark[spark.length-1]:null;
            const first=spark?spark[0]:null;
            const change=last&&first?((last-first)/first*100):0;
            return (
              <div key={x.p} style={{display:"flex", alignItems:"center", gap:8, padding:"5px 8px", background:C.bg, borderRadius:5, border:`1px solid ${C.border}`}}>
                <span style={{fontSize:11}}>{x.f}</span>
                <span style={{color:C.accent, fontFamily:"JetBrains Mono", fontSize:10, fontWeight:700, minWidth:72}}>{x.p}</span>
                <span style={{color:C.text, fontFamily:"JetBrains Mono", fontSize:11, fontWeight:700, minWidth:70}}>
                  {parseFloat(x.v).toFixed(x.decimals)}
                </span>
                {spark && <Sparkline data={spark} color={x.p} width={70} height={24}/>}
                {spark && (
                  <span style={{fontSize:9, color:change>=0?C.green:C.red, fontFamily:"JetBrains Mono", minWidth:44, textAlign:"right"}}>
                    {change>=0?"â–²":"â–¼"}{Math.abs(change).toFixed(2)}%
                  </span>
                )}
              </div>
            );
          })}
          <div style={{fontSize:9, color:live?C.green:C.muted, textAlign:"right", fontFamily:"JetBrains Mono"}}>
            {live?"â— LIVE Â· ExchangeRate-API":"â—‹ ì—°ê²° ì¤‘..."}
          </div>
        </div>
      );
    }

    function CryptoLive() {
      const [data, setData] = useState([
        {n:"BTC",p:85420,c:2.3},{n:"ETH",p:2180,c:1.8},
        {n:"USDT",p:1.0,c:0.0},{n:"XRP",p:2.18,c:-1.2},{n:"SOL",p:142.5,c:3.1},
      ]);
      const [live, setLive] = useState(false);
      useEffect(()=>{
        const go=async()=>{
          try{
            const r=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,tether,ripple,solana&vs_currencies=usd&include_24hr_change=true");
            if(!r.ok)return;
            const d=await r.json();
            setData([
              {n:"BTC",  p:d.bitcoin?.usd,  c:d.bitcoin?.usd_24h_change},
              {n:"ETH",  p:d.ethereum?.usd, c:d.ethereum?.usd_24h_change},
              {n:"USDT", p:d.tether?.usd,   c:d.tether?.usd_24h_change},
              {n:"XRP",  p:d.ripple?.usd,   c:d.ripple?.usd_24h_change},
              {n:"SOL",  p:d.solana?.usd,   c:d.solana?.usd_24h_change},
            ]);
            setLive(true);
          } catch {}
        };
        go(); const iv=setInterval(go,30000); return()=>clearInterval(iv);
      },[]);
      return (
        <div style={{padding:"8px 10px", display:"flex", flexDirection:"column", gap:5}}>
          {data.map(x=>(
            <div key={x.n} style={{display:"flex", justifyContent:"space-between", padding:"5px 8px", background:C.bg, borderRadius:4, border:`1px solid ${C.border}` }}>
              <span style={{color:C.gold,fontFamily:"JetBrains Mono",fontSize:10,fontWeight:700}}>{x.n}</span>
              <span style={{color:C.text,fontFamily:"JetBrains Mono",fontSize:10}}>${x.p<10?x.p?.toFixed(4):x.p?.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
              <span style={{color:x.c>=0?C.green:C.red,fontSize:9}}>{x.c>=0?"â–²":"â–¼"}{Math.abs(x.c||0).toFixed(2)}%</span>
            </div>
          ))}
          <div style={{fontSize:9,color:live?C.green:C.muted,textAlign:"right",fontFamily:"JetBrains Mono"}}>{live?"â— LIVE Â· CoinGecko":"â—‹ ì—°ê²° ì¤‘..."}</div>
        </div>
      );
    }

    function Box({title,badge,children,style}){
      return (
        <div style={{background:C.panel,border:`1px solid ${C.border}`,borderRadius:6,overflow:"hidden",...style}}>
          <div style={{fontFamily:"'Space Grotesk',sans-serif",fontSize:11,fontWeight:700,letterSpacing:"0.1em",textTransform:"uppercase",color:C.muted,padding:"8px 12px",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
            <span>{title}</span>
            {badge && <span>{badge}</span>}
          </div>
          {children}
        </div>
      );
    }

    function App() {
      const [clock, setClock] = useState(new Date());
      useEffect(() => { const iv = setInterval(() => setClock(new Date()), 1000); return () => clearInterval(iv); }, []);

      const kst=new Date(clock.toLocaleString("en-US", {timeZone:"Asia/Seoul"}));
      const nyc=new Date(clock.toLocaleString("en-US", {timeZone:"America/New_York"}));
      const nyOpen=nyc.getHours()>=9 && nyc.getHours()<16;

      return (
        <div style={{ background:C.bg, minHeight:"100vh", fontFamily:"'JetBrains Mono','Courier New',monospace", color:C.text }}>
          <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"0 16px", height:44, background:"#040608", borderBottom:`1px solid ${C.border}` }}>
            <div style={{ display:"flex", alignItems:"center", gap:12 }}>
              <div style={{ width:3, height:22, background:C.accent, borderRadius:2 }} />
              <span style={{ fontFamily:"Space Grotesk", fontSize:16, fontWeight:700, color:C.accent, letterSpacing:"0.05em" }}>MACRO TERMINAL</span>
              <span style={{ fontSize:9, color:C.muted, background:C.panel, padding:"2px 8px", borderRadius:10, border:`1px solid ${C.border}` }}>GLOBAL MARKETS Â· TRADINGVIEW</span>
            </div>
            <div style={{ display:"flex", gap:16, fontSize:10, color:C.muted, alignItems:"center" }}>
              <span>KST <span style={{ color:C.accent }}>{kst.toLocaleTimeString("ko-KR",{hour12:false})}</span></span>
              <span>NYC <span style={{ color:C.gold }}>{nyc.toLocaleTimeString("en-US",{hour12:false})}</span></span>
              <span style={{ color:nyOpen?C.green:C.red, fontSize:9, padding:"2px 8px", border:`1px solid ${(nyOpen?C.green:C.red)}55`, borderRadius:3 }}>â— NYSE {nyOpen?"OPEN":"CLOSED"}</span>
            </div>
          </div>

          <div style={{ borderBottom:`1px solid ${C.border}`, height:46, overflow:"hidden" }}>
            <TV type="ticker-tape" height={46} opts={{
              symbols:[
                {proName:"FOREXCOM:SPXUSD",title:"S&P 500"},{proName:"FOREXCOM:NSXUSD",title:"NASDAQ 100"},
                {proName:"DJ:DJI",title:"DOW JONES"},{proName:"KRX:KOSPI",title:"KOSPI"},
                {proName:"INDEX:NKY",title:"NIKKEI 225"},{proName:"INDEX:DEU40",title:"DAX"},
                {proName:"INDEX:HSI",title:"í•­ì…"},{proName:"SSE:000001",title:"ìƒí•˜ì´"},
                {proName:"BITSTAMP:BTCUSD",title:"BTC/USD"},{proName:"BITSTAMP:ETHUSD",title:"ETH/USD"},
                {proName:"FOREXCOM:USDKRW",title:"USD/KRW"},{proName:"FOREXCOM:USDJPY",title:"USD/JPY"},
                {proName:"COMEX:GC1!",title:"ê¸ˆ ì„ ë¬¼"},{proName:"NYMEX:CL1!",title:"WTI ì›ìœ "},
              ],
              showSymbolLogo:false, displayMode:"adaptive"
            }} />
          </div>

          <div style={{ padding:"10px 12px", display:"flex", flexDirection:"column", gap:10 }}>
            <CapitalFlowHero />

            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:12 }}>
              <Box title="FX & Trends"><FXWithSparkline /></Box>
              <Box title="Market Insight">
                <div style={{padding:"12px", fontSize:11, lineHeight:1.6}}>
                  <div style={{color:C.accent, fontWeight:700, marginBottom:8}}>ğŸ¤– Jarvis Insight ({JARVIS_INSIGHT.date})</div>
                  <div style={{color:C.text}}>{JARVIS_INSIGHT.summary}</div>
                  <div style={{marginTop:10, color:C.gold, fontSize:10}}>{JARVIS_INSIGHT.strategy}</div>
                </div>
              </Box>
              <Box title="Crypto & Status" badge={<span style={{fontSize:9, color:C.green}}>ONLINE</span>}>
                 <CryptoLive />
                 <div style={{padding:"8px 12px", borderTop:`1px solid ${C.border}`, marginTop:5}}>
                    <div style={{fontSize:9, color:C.muted}}>ë¶„ì„ ì—”ì§„: <span style={{color:C.accent}}>Jarvis Core 3.1</span></div>
                    <div style={{fontSize:9, color:C.muted}}>ë°ì´í„°: <span style={{color:C.text}}>Sim v2.5</span></div>
                 </div>
              </Box>
            </div>

            <Box title="ê¸€ë¡œë²Œ ì¦ì‹œ Â· Global Indices" badge={<span style={{fontSize:9,color:C.green}}>â— TRADINGVIEW REAL-TIME</span>}>
              <TV type="market-overview" height={220} opts={{
                dateRange:"1D", showChart:true,
                tabs:[
                  {title:"ì£¼ìš” ì§€ìˆ˜",symbols:[{s:"FOREXCOM:SPXUSD",d:"S&P 500"},{s:"FOREXCOM:NSXUSD",d:"NASDAQ 100"},{s:"DJ:DJI",d:"DOW JONES"},{s:"KRX:KOSPI",d:"KOSPI"},{s:"INDEX:NKY",d:"NIKKEI 225"},{s:"INDEX:DEU40",d:"DAX"}]},
                  {title:"ì•„ì‹œì•„",symbols:[{s:"KRX:KOSPI",d:"KOSPI"},{s:"INDEX:NKY",d:"NIKKEI"},{s:"INDEX:HSI",d:"í•­ì…"},{s:"SSE:000001",d:"ìƒí•˜ì´"}]}
                ]
              }} />
            </Box>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
