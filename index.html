<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>GLOBAL MACRO INTELLIGENCE Â· v1.0</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
html,body,#root{min-height:100vh;background:#04060d;color:#c8d4e0;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:#04060d;}
::-webkit-scrollbar-thumb{background:#1c2535;border-radius:2px;}
input[type=range]{-webkit-appearance:none;background:transparent;cursor:pointer;width:100%;}
input[type=range]::-webkit-slider-runnable-track{background:#1c2535;border-radius:3px;height:3px;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;border-radius:50%;background:#00d4ff;margin-top:-4.5px;}
.btn{padding:4px 11px;border-radius:3px;font-size:10px;font-family:'JetBrains Mono',monospace;cursor:pointer;border:1px solid #1c2535;background:transparent;color:#4a5a6a;transition:all .15s;letter-spacing:.04em;}
.btn:hover{color:#c8d4e0;border-color:#2a3545;}
.btn.a{border-color:#00d4ff;background:#00d4ff15;color:#00d4ff;}
.btn.ga{border-color:#f0b429;background:#f0b42915;color:#f0b429;}
.btn.ra{border-color:#ff3355;background:#ff335515;color:#ff3355;}
.btn.pa{border-color:#bb86fc;background:#bb86fc15;color:#bb86fc;}
@keyframes pulseRing{0%{transform:scale(.85);opacity:.8}100%{transform:scale(1.5);opacity:0}}
@keyframes flowLine{0%{stroke-dashoffset:100}100%{stroke-dashoffset:0}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.blink{animation:blink 1.8s infinite;}
.mono{font-family:'JetBrains Mono',monospace;}
.sans{font-family:'Space Grotesk',sans-serif;}
</style>
</head>
<body><div id="root"></div>
<script type="text/babel" data-presets="env,react">
const {useState,useEffect,useRef,useMemo,useCallback}=React;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const T={
  bg:"#04060d",panel:"#080e1a",panel2:"#0c1420",border:"#1c2535",border2:"#243045",
  accent:"#00d4ff",gold:"#f0b429",green:"#00e676",red:"#ff3355",purple:"#bb86fc",orange:"#ff8c00",
  teal:"#00bcd4",pink:"#ff4081",lime:"#cddc39",
  text:"#c8d4e0",muted:"#4a5a6a",dim:"#2a3a4a",
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE DATA â€” API KEYS & HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FRED_KEY='b265c038167e9fa6fc34678a62c9c2a4';
const AV_KEY='E4707A6I8NXZOF6K';
const FH_KEY='d6hg6m9r01qr5k4breqgd6hg6m9r01qr5k4brer0';

// React Context for live data sharing across all components
const LiveCtx=React.createContext(null);
function useLive(){return React.useContext(LiveCtx)||{};}

// FRED: fetch series observations, return most recent non-null value
function fredVal(series){
  return fetch("https://api.stlouisfed.org/fred/series/observations?series_id="+series+"&api_key="+FRED_KEY+"&limit=5&sort_order=desc&file_type=json")
    .then(function(r){return r.json();})
    .then(function(d){
      var obs=(d.observations||[]).filter(function(o){return o.value!=="."&&o.value!=="";});
      return obs.length?parseFloat(obs[0].value):null;
    })
    .catch(function(){return null;});
}

function fredCpiYoy(){
  return fetch("https://api.stlouisfed.org/fred/series/observations?series_id=CPIAUCSL&api_key="+FRED_KEY+"&limit=15&sort_order=desc&file_type=json")
    .then(function(r){return r.json();})
    .then(function(d){
      var obs=(d.observations||[]).filter(function(o){return o.value!=="."&&o.value!=="";});
      if(obs.length<13)return null;
      return +((parseFloat(obs[0].value)/parseFloat(obs[12].value)-1)*100).toFixed(2);
    })
    .catch(function(){return null;});
}

function avComm(func){
  return fetch("https://www.alphavantage.co/query?function="+func+"&interval=monthly&apikey="+AV_KEY)
    .then(function(r){return r.json();})
    .then(function(d){
      if(d["Note"]||d["Information"])return null;
      var latest=d.data&&d.data[0];
      return latest?+parseFloat(latest.value).toFixed(3):null;
    })
    .catch(function(){return null;});
}

function fhNews(){
  return fetch("https://finnhub.io/api/v1/news?category=general&token="+FH_KEY)
    .then(function(r){return r.json();})
    .then(function(d){return Array.isArray(d)?d.filter(function(n){return n.headline&&n.url;}).slice(0,20):[];})
    .catch(function(){return[];});
}

function fhEconCal(){
  var from=new Date();from.setDate(from.getDate()-7);
  var to=new Date();to.setDate(to.getDate()+14);
  var fmt=function(d){return d.toISOString().slice(0,10);};
  return fetch("https://finnhub.io/api/v1/calendar/economic?from="+fmt(from)+"&to="+fmt(to)+"&token="+FH_KEY)
    .then(function(r){return r.json();})
    .then(function(d){return (d.economicCalendar||[]).filter(function(e){return e.impact==="High"||e.impact==="Medium";}).slice(0,25);})
    .catch(function(){return[];});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA â€” 9 REGIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const REGIONS=[
  {
    id:"us",name:"ë¯¸êµ­",en:"United States",flag:"ğŸ‡ºğŸ‡¸",color:"#00d4ff",
    mapX:0.17,mapY:0.38,mapR:62,
    gdp:27.4,gdpGrowth:2.8,cpi:3.2,unemploy:3.9,pmi:51.6,
    policyRate:4.25,rate10y:4.52,rate2y:4.18,currentAcct:-3.1,debtGdp:122,
    equity:"S&P 4,927",equityChg:+1.2,currency:"USD",
    fxVsUsd:1.0,fxChg:0,
    energy:"ì£¼ìš” ì†Œë¹„Â·LNG ìˆ˜ì¶œêµ­",energyRole:"ì†Œë¹„+ìˆ˜ì¶œ",
    commodity:"ë‹¬ëŸ¬ ê¸°ì¶•Â·ê¸ˆìœµíŒ¨ê¶Œ",
    nextCB:"2025-03-19",cbName:"Fed",stance:"ì¤‘ë¦½â†’ì™„í™”",stanceDir:1,
    geopolRisk:45,tradePower:95,finPower:100,
    stockMarkets:["S&P500","NASDAQ","DOW","Russell2000"],
    tvSymbol:"FOREXCOM:SPXUSD",
    yields:[4.05,4.11,4.18,4.25,4.38,4.52,4.63,4.73],
    keyEvents:["íŠ¸ëŸ¼í”„ ê´€ì„¸ 2.0","Fed í”¼ë´‡ ê¸°ëŒ€","AI ì¸í”„ë¼ ë¶","ê°•ë‹¬ëŸ¬ ì‚¬ì´í´"],
    description:"ì„¸ê³„ ìµœëŒ€ ê²½ì œÂ·ê¸ˆìœµíŒ¨ê¶Œêµ­. ë‹¬ëŸ¬ ê¸°ì¶•í†µí™”ë¡œ ê¸€ë¡œë²Œ ìê¸ˆíë¦„ ì§€ë°°.",
  },
  {
    id:"cn",name:"ì¤‘êµ­",en:"China",flag:"ğŸ‡¨ğŸ‡³",color:"#ff3355",
    mapX:0.77,mapY:0.40,mapR:58,
    gdp:17.9,gdpGrowth:4.6,cpi:0.4,unemploy:5.1,pmi:50.2,
    policyRate:3.10,rate10y:2.35,rate2y:2.10,currentAcct:1.8,debtGdp:88,
    equity:"CSI300 3,512",equityChg:-0.8,currency:"CNY",
    fxVsUsd:7.24,fxChg:-0.2,
    energy:"ì„¸ê³„ ìµœëŒ€ ì„íƒ„Â·ì›ìœ  ìˆ˜ì…êµ­",energyRole:"ìµœëŒ€ ì†Œë¹„",
    commodity:"í¬í† ë¥˜ 85% ì¥ì•…Â·ë°°í„°ë¦¬ ê³µê¸‰ë§",
    nextCB:"2025-02-20",cbName:"PBOC",stance:"ì™„í™”ì ",stanceDir:1,
    geopolRisk:82,tradePower:88,finPower:72,
    stockMarkets:["ìƒí•˜ì´ì¢…í•©","CSI300","ì„ ì „ì„±ë¶„","í•­ì…"],
    tvSymbol:"SSE:000001",
    yields:[1.80,1.92,2.02,2.10,2.20,2.35,2.48,2.62],
    keyEvents:["ë¶€ë™ì‚° ë””ë ˆë²„ë¦¬ì§•","ë¯¸ì¤‘ ë°˜ë„ì²´ ì „ìŸ","ìœ„ì•ˆí™” ì ˆí•˜ ì••ë ¥","ë””í”Œë ˆì´ì…˜ ìš°ë ¤"],
    description:"ì„¸ê³„ 2ìœ„ ê²½ì œÂ·ì œì¡°ì—… íŒ¨ê¶Œ. í¬í† ë¥˜Â·ë°°í„°ë¦¬ ê³µê¸‰ë§ ì¥ì•…. ë¯¸êµ­ê³¼ íŒ¨ê¶Œ ê²½ìŸ.",
  },
  {
    id:"jp",name:"ì¼ë³¸",en:"Japan",flag:"ğŸ‡¯ğŸ‡µ",color:"#ff8c00",
    mapX:0.85,mapY:0.35,mapR:44,
    gdp:4.2,gdpGrowth:1.2,cpi:2.8,unemploy:2.4,pmi:49.0,
    policyRate:0.50,rate10y:1.05,rate2y:0.38,currentAcct:3.5,debtGdp:264,
    equity:"Nikkei 38,820",equityChg:+0.5,currency:"JPY",
    fxVsUsd:149.2,fxChg:+0.8,
    energy:"ì„¸ê³„ ìµœëŒ€ LNG ìˆ˜ì…êµ­ ì¤‘ í•˜ë‚˜",energyRole:"ì—ë„ˆì§€ ì˜ì¡´",
    commodity:"ì²¨ë‹¨ì†Œì¬Â·ë°˜ë„ì²´ì¥ë¹„ ìˆ˜ì¶œ",
    nextCB:"2025-03-19",cbName:"BOJ",stance:"ê¸´ì¶• ì‹œì‘",stanceDir:-1,
    geopolRisk:30,tradePower:72,finPower:65,
    stockMarkets:["Nikkei225","TOPIX"],
    tvSymbol:"INDEX:NKY",
    yields:[0.08,0.15,0.25,0.38,0.60,1.05,1.35,1.55],
    keyEvents:["BOJ ê¸ˆë¦¬ ì •ìƒí™”","ì—”í™” ìºë¦¬íŠ¸ë ˆì´ë“œ ì²­ì‚°","ì„ê¸ˆ ìƒìŠ¹","ì—”ì € ìˆ˜ì¶œ ìˆ˜í˜œ"],
    description:"ì„¸ê³„ ìµœëŒ€ ì±„ê¶Œêµ­. ì—”ìºë¦¬ íŠ¸ë ˆì´ë“œ ì²­ì‚°ì€ ê¸€ë¡œë²Œ ë³€ë™ì„± í­ë°œ íŠ¸ë¦¬ê±°.",
  },
  {
    id:"kr",name:"í•œêµ­",en:"South Korea",flag:"ğŸ‡°ğŸ‡·",color:"#ff9800",
    mapX:0.82,mapY:0.37,mapR:36,
    gdp:1.7,gdpGrowth:2.1,cpi:2.0,unemploy:3.0,pmi:49.8,
    policyRate:2.75,rate10y:3.02,rate2y:2.82,currentAcct:3.2,debtGdp:54,
    equity:"KOSPI 2,486",equityChg:-0.3,currency:"KRW",
    fxVsUsd:1368,fxChg:+0.5,
    energy:"ì„¸ê³„ 5ìœ„ LNG ìˆ˜ì…êµ­",energyRole:"ì—ë„ˆì§€ ì˜ì¡´",
    commodity:"ë°˜ë„ì²´(DRAMÂ·HBM) ì„¸ê³„ 1ìœ„",
    nextCB:"2025-02-25",cbName:"BOK",stance:"ì™„í™” ì¤‘",stanceDir:1,
    geopolRisk:48,tradePower:55,finPower:42,
    stockMarkets:["KOSPI","KOSDAQ"],
    tvSymbol:"KRX:KOSPI",
    yields:[2.40,2.58,2.70,2.82,2.95,3.02,3.10,3.18],
    keyEvents:["ì½”ë¦¬ì•„ ë””ìŠ¤ì¹´ìš´íŠ¸","HBM ìˆ˜ìš” í­ë°œ","ì™¸êµ­ì¸ ìˆœë§¤ë„","ì •ì¹˜ ë¶ˆí™•ì‹¤ì„±"],
    description:"ë°˜ë„ì²´(ì‚¼ì„±Â·SKí•˜ì´ë‹‰ìŠ¤) AI ì¸í”„ë¼ì˜ í•µì‹¬ ê³µê¸‰ì. PBR 0.85x ì €í‰ê°€.",
  },
  {
    id:"tw",name:"ëŒ€ë§Œ",en:"Taiwan",flag:"ğŸ‡¹ğŸ‡¼",color:"#00e676",
    mapX:0.80,mapY:0.43,mapR:32,
    gdp:0.78,gdpGrowth:3.8,cpi:1.8,unemploy:3.5,pmi:52.1,
    policyRate:2.00,rate10y:1.95,rate2y:1.55,currentAcct:14.2,debtGdp:27,
    equity:"Taiwan50 1,628",equityChg:+2.1,currency:"TWD",
    fxVsUsd:31.8,fxChg:-0.1,
    energy:"ì—ë„ˆì§€ ì™„ì „ ìˆ˜ì… ì˜ì¡´",energyRole:"ì—ë„ˆì§€ ì˜ì¡´",
    commodity:"TSMC â€” íŒŒìš´ë“œë¦¬ ì„¸ê³„ 1ìœ„(90%)",
    nextCB:"2025-03-27",cbName:"CBC",stance:"ì¤‘ë¦½",stanceDir:0,
    geopolRisk:72,tradePower:38,finPower:35,
    stockMarkets:["TAIEX"],
    tvSymbol:"TWSE:Y9999",
    yields:[0.90,1.10,1.30,1.55,1.75,1.95,2.10,2.25],
    keyEvents:["TSMC ì§€ì •í•™ ë¦¬ìŠ¤í¬","AIì¹© íŒ¨ê¶Œ","ì¤‘êµ­ ìœ„í˜‘ ì¦ê°€","ë¯¸êµ­ ì§€ì›"],
    description:"TSMC = ì„¸ê³„ ì²¨ë‹¨ë°˜ë„ì²´ ìƒì‚° 80~90%. ì§€ì •í•™ì  ìµœê³  í•«ìŠ¤íŒŸ.",
  },
  {
    id:"eu",name:"ìœ ëŸ½",en:"Europe (EU)",flag:"ğŸ‡ªğŸ‡º",color:"#7c6af5",
    mapX:0.48,mapY:0.30,mapR:52,
    gdp:18.4,gdpGrowth:0.8,cpi:2.3,unemploy:6.2,pmi:47.3,
    policyRate:2.65,rate10y:2.65,rate2y:2.38,currentAcct:2.8,debtGdp:91,
    equity:"DAX 18,205",equityChg:+0.4,currency:"EUR",
    fxVsUsd:1.088,fxChg:+0.2,
    energy:"ëŸ¬ì‹œì•„ ì—ë„ˆì§€ ì˜ì¡´ íƒˆí”¼ ì¤‘",energyRole:"ì—ë„ˆì§€ ì˜ì¡´â†’ë‹¤ë³€í™”",
    commodity:"ëŸ­ì…”ë¦¬Â·ìë™ì°¨ ìˆ˜ì¶œ",
    nextCB:"2025-03-06",cbName:"ECB",stance:"ì™„í™” ì¤‘",stanceDir:1,
    geopolRisk:58,tradePower:78,finPower:68,
    stockMarkets:["DAX","CAC40","FTSE100","MIB","AEX"],
    tvSymbol:"INDEX:DEU40",
    yields:[2.05,2.18,2.28,2.38,2.50,2.65,2.78,2.95],
    keyEvents:["ëŸ¬-ìš° ì „ìŸ ê²½ì œ íƒ€ê²©","ë¯¸êµ­ ê´€ì„¸ ìœ„í˜‘","ì—ë„ˆì§€ ì „í™˜ ê°€ì†","ë…ì¼ ì¹¨ì²´"],
    description:"ì„¸ê³„ ìµœëŒ€ ë‹¨ì¼ ì‹œì¥. ëŸ¬ì‹œì•„ ì—ë„ˆì§€ ì´íƒˆ íƒ€ê²© + ë¯¸êµ­ ê´€ì„¸ ìœ„í˜‘ ì´ì¤‘ê³ .",
  },
  {
    id:"me",name:"ì¤‘ë™",en:"Middle East",flag:"ğŸ•Œ",color:"#ffd700",
    mapX:0.58,mapY:0.48,mapR:40,
    gdp:3.8,gdpGrowth:3.2,cpi:4.1,unemploy:6.8,pmi:54.2,
    policyRate:5.50,rate10y:5.20,rate2y:5.10,currentAcct:8.5,debtGdp:35,
    equity:"TADAWUL 11,250",equityChg:+0.8,currency:"USD-pegged",
    fxVsUsd:3.75,fxChg:0,
    energy:"ì„¸ê³„ ì„ìœ  33% + LNG ê³µê¸‰",energyRole:"ìµœëŒ€ ì—ë„ˆì§€ ê³µê¸‰",
    commodity:"ì›ìœ Â·LNGÂ·êµ­ë¶€í€ë“œ(SWF)",
    nextCB:"â€”",cbName:"SAMA/UAE CB",stance:"Fed ì—°ë™",stanceDir:1,
    geopolRisk:68,tradePower:62,finPower:55,
    stockMarkets:["TADAWUL(ì‚¬ìš°ë””)","DFM(UAE)","ì¹´íƒ€ë¥´QE"],
    tvSymbol:"INDEX:TASI",
    yields:[4.80,4.90,5.00,5.10,5.15,5.20,5.25,5.30],
    keyEvents:["OPEC+ ê°ì‚° ì •ì±…","ì´ìŠ¤ë¼ì—˜-ì´ë€ ê¸´ì¥","ë¹„ì „2030(ì‚¬ìš°ë””)","íƒˆì„ìœ  ë‹¤ë³€í™”"],
    description:"ì›ìœ  ê³µê¸‰ì˜ í•µì‹¬. SWF(êµ­ë¶€í€ë“œ) ì•½ $3.5T ê·œëª¨ ê¸€ë¡œë²Œ ìì‚° ìš´ìš©.",
  },
  {
    id:"latam",name:"ì¤‘ë‚¨ë¯¸",en:"Latin America",flag:"ğŸŒ",color:"#ff6b35",
    mapX:0.24,mapY:0.62,mapR:42,
    gdp:5.8,gdpGrowth:2.1,cpi:8.2,unemploy:8.5,pmi:50.4,
    policyRate:10.50,rate10y:12.8,rate2y:11.2,currentAcct:-1.8,debtGdp:78,
    equity:"BOVESPA 127,400",equityChg:-1.2,currency:"BRL/MXN",
    fxVsUsd:4.97,fxChg:+1.5,
    energy:"ë¸Œë¼ì§ˆ ì›ìœ Â·ì²œì—°ê°€ìŠ¤ ì‹ í¥",energyRole:"ì—ë„ˆì§€ ìƒì‚°Â·ê³µê¸‰",
    commodity:"êµ¬ë¦¬(ì¹ ë ˆ)Â·ë¦¬íŠ¬(ë³¼ë¦¬ë¹„ì•„Â·ì•„ë¥´í—¨)Â·ëŒ€ë‘(ë¸Œë¼ì§ˆ)",
    nextCB:"2025-03-05",cbName:"BCB/Banxico",stance:"ê¸´ì¶•â†’ì™„í™” ëª¨ìƒ‰",stanceDir:1,
    geopolRisk:55,tradePower:42,finPower:35,
    stockMarkets:["BOVESPA(ë¸Œë¼ì§ˆ)","IPC(ë©•ì‹œì½”)","MERVAL(ì•„ë¥´í—¨)"],
    tvSymbol:"BMFBOVESPA:IBOV",
    yields:[10.5,11.2,11.8,12.2,12.5,12.8,13.0,13.2],
    keyEvents:["ë¦¬íŠ¬ ì‚¼ê°ì§€ëŒ€ ìì› ì „ìŸ","ë‹¬ëŸ¬ ê°•ì„¸ ë¶€ì±„ ë¶€ë‹´","ì¤‘êµ­ ìì› íˆ¬ì í™•ëŒ€","ë¯¸êµ­ ê·¼í•´ ë¦¬ì‡¼ì–´ë§"],
    description:"ë¦¬íŠ¬(EVë°°í„°ë¦¬)Â·êµ¬ë¦¬(AIì¸í”„ë¼)ì˜ í•µì‹¬ ë³´ê³ . ê¸€ë¡œë²Œ íƒˆíƒ„ì†Œí™”ì˜ ì—´ì‡ .",
  },
  {
    id:"oceania",name:"ì˜¤ì„¸ì•„ë‹ˆì•„",en:"Oceania (AUS/NZ)",flag:"ğŸ¦˜",color:"#00bcd4",
    mapX:0.83,mapY:0.72,mapR:36,
    gdp:1.7,gdpGrowth:1.5,cpi:3.2,unemploy:4.2,pmi:48.5,
    policyRate:4.35,rate10y:4.42,rate2y:4.10,currentAcct:-1.2,debtGdp:48,
    equity:"ASX200 7,820",equityChg:+0.6,currency:"AUD",
    fxVsUsd:0.64,fxChg:-0.3,
    energy:"LNG ì„¸ê³„ 2ìœ„ ìˆ˜ì¶œêµ­(í˜¸ì£¼)",energyRole:"ì—ë„ˆì§€ ìˆ˜ì¶œ",
    commodity:"ì² ê´‘ì„Â·ì„íƒ„Â·ë¦¬íŠ¬Â·ê¸ˆÂ·LNG",
    nextCB:"2025-03-04",cbName:"RBA",stance:"ì™„í™” ì‹œì‘",stanceDir:1,
    geopolRisk:22,tradePower:38,finPower:30,
    stockMarkets:["ASX200"],
    tvSymbol:"ASX:XJO",
    yields:[4.00,4.05,4.10,4.15,4.25,4.42,4.55,4.65],
    keyEvents:["ì¤‘êµ­ ì² ê´‘ì„ ìˆ˜ìš” ê°ì†Œ","ë¦¬íŠ¬ ê³µê¸‰ê³¼ì‰","AUKUS ë°©ìœ„ í˜‘ì•½","ì¸í”Œë ˆ ì™„í™” ê¸°ë¯¸"],
    description:"ì›ìì¬(ì² ê´‘ì„Â·ì„íƒ„Â·ë¦¬íŠ¬Â·LNG) ëŒ€ì¤‘êµ­ ìˆ˜ì¶œ ì˜ì¡´ë„ ë†’ì€ ìì› ê°•êµ­.",
  },
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEDGE FUND DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const HEDGE_FUNDS=[
  {name:"Bridgewater",aum:"$149B",founder:"Ray Dalio",style:"ë¦¬ìŠ¤í¬íŒ¨ë¦¬í‹°Â·ê±°ì‹œ",
   positions:[
     {asset:"ê¸ˆ",stance:"LONG",size:85,note:"ì¸í”Œë ˆÂ·ì§€ì •í•™ í—¤ì§€"},
     {asset:"USì±„ê¶Œ",stance:"NEUTRAL",size:48,note:"ë¦¬ìŠ¤í¬íŒ¨ë¦¬í‹° ì¬ì¡°ì •"},
     {asset:"ì‹ í¥ì‹œì¥ì±„ê¶Œ",stance:"LONG",size:62,note:"ë‹¬ëŸ¬ ì•½ì„¸ ë² íŒ…"},
     {asset:"ì¤‘êµ­ì£¼ì‹",stance:"UNDERWEIGHT",size:22,note:"ì§€ì •í•™ ë¦¬ìŠ¤í¬ ì¶•ì†Œ"},
     {asset:"ì›ìì¬",stance:"LONG",size:70,note:"ì¸í”Œë ˆì´ì…˜ í—¤ì§€"},
   ],color:"#00d4ff",regime:"ì¸í”Œë ˆì´ì…˜ í—¤ì§€ êµ­ë©´"},
  {name:"Citadel",aum:"$63B",founder:"Ken Griffin",style:"ë©€í‹°ìŠ¤íŠ¸ë˜í‹°ì§€Â·í€€íŠ¸",
   positions:[
     {asset:"ë¯¸êµ­ì£¼ì‹(ë¡±ìˆ)",stance:"NET LONG",size:72,note:"AIÂ·ê¸°ìˆ ì£¼ ì§‘ì¤‘"},
     {asset:"í¬ë ˆë”§",stance:"LONG",size:55,note:"HY ìŠ¤í”„ë ˆë“œ ìˆ˜ë ´"},
     {asset:"FX ë³€ë™ì„±",stance:"SHORT VOL",size:40,note:"VIX ì•ˆì • í™œìš©"},
     {asset:"ì—ë„ˆì§€",stance:"NEUTRAL",size:45,note:"OPEC ë¶ˆí™•ì‹¤ì„±"},
     {asset:"ë°˜ë„ì²´",stance:"OVERWEIGHT",size:88,note:"AI ìˆ˜ìš” ì§€ì†"},
   ],color:"#ff3355",regime:"ë¦¬ìŠ¤í¬ì˜¨Â·ì•ŒíŒŒ ì¶”êµ¬"},
  {name:"Renaissance",aum:"$55B",founder:"Jim Simons",style:"í€€íŠ¸Â·í†µê³„ì ì°¨ìµ",
   positions:[
     {asset:"ë‹¨ê¸° ëª¨ë©˜í…€",stance:"LONG",size:80,note:"íŠ¸ë Œë“œ íŒ”ë¡œì‰"},
     {asset:"í†µê³„ì  ì°¨ìµ",stance:"ACTIVE",size:90,note:"íŒ¨í„´ ì¸ì‹"},
     {asset:"íŒŒìƒìƒí’ˆ",stance:"COMPLEX",size:75,note:"ì˜µì…˜ ì „ëµ"},
     {asset:"FX",stance:"ACTIVE",size:65,note:"ë‹¨ê¸° FX íŠ¸ë ˆì´ë”©"},
     {asset:"ì›ìì¬",stance:"LONG",size:58,note:"ì‹œì¦ˆë„ë¦¬í‹° íŒ¨í„´"},
   ],color:"#bb86fc",regime:"í€€íŠ¸ ëª¨ë©˜í…€"},
  {name:"Two Sigma",aum:"$58B",founder:"John Overdeck",style:"ë°ì´í„°Â·AI ê¸°ë°˜",
   positions:[
     {asset:"AIÂ·í…Œí¬",stance:"OVERWEIGHT",size:85,note:"AI í…Œë§ˆ ì§‘ì¤‘"},
     {asset:"ê¸€ë¡œë²Œ ë§¤í¬ë¡œ",stance:"NEUTRAL",size:50,note:"ë°ì´í„° ê¸°ë°˜ ì¤‘ë¦½"},
     {asset:"í¬ë¦½í† ",stance:"SELECTIVE",size:35,note:"ê·œì œ ë¦¬ìŠ¤í¬ ê°ì•ˆ"},
     {asset:"ì˜ë£ŒÂ·ë°”ì´ì˜¤",stance:"LONG",size:62,note:"AI ì‹ ì•½ ê°œë°œ"},
     {asset:"ì—ë„ˆì§€ ì „í™˜",stance:"LONG",size:70,note:"ì¬ìƒì—ë„ˆì§€ í™•ëŒ€"},
   ],color:"#00e676",regime:"AI í…Œë§ˆ ì£¼ë„"},
  {name:"Millennium",aum:"$68B",founder:"Izzy Englander",style:"ë©€í‹°ë§¤ë‹ˆì €Â·ì°¨ìµ",
   positions:[
     {asset:"ë©€í‹°ìŠ¤íŠ¸ë˜í‹°ì§€",stance:"DIVERSIFIED",size:88,note:"ë¶„ì‚° í¬ë“œ ìš´ì˜"},
     {asset:"í•©ë³‘ ì°¨ìµ",stance:"ACTIVE",size:55,note:"M&A íŒŒì´í”„ë¼ì¸"},
     {asset:"ì „í™˜ì‚¬ì±„",stance:"LONG",size:62,note:"ë³€ë™ì„± í™œìš©"},
     {asset:"ì•„ì‹œì•„ ì£¼ì‹",stance:"SELECTIVE",size:45,note:"í•œêµ­Â·ëŒ€ë§Œ ë°˜ë„ì²´"},
     {asset:"ê¸€ë¡œë²Œ ì±„ê¶Œ",stance:"DURATION",size:58,note:"ê¸ˆë¦¬ ì •ìƒí™” ìˆ˜í˜œ"},
   ],color:"#f0b429",regime:"ì°¨ìµÂ·ë¶„ì‚°"},
  {name:"Baupost",aum:"$27B",founder:"Seth Klarman",style:"ê°€ì¹˜íˆ¬ìÂ·íŠ¹ìˆ˜ìƒí™©",
   positions:[
     {asset:"ì €í‰ê°€ ì£¼ì‹",stance:"DEEP VALUE",size:75,note:"ì½”ë¦¬ì•„ ë””ìŠ¤ì¹´ìš´íŠ¸ ì£¼ëª©"},
     {asset:"ë¶€ì‹¤ì±„ê¶Œ",stance:"OPPORTUNISTIC",size:60,note:"ì¤‘êµ­ ë¶€ë™ì‚° ê´€ë ¨"},
     {asset:"ë‹¬ëŸ¬ í˜„ê¸ˆ",stance:"HIGH CASH",size:85,note:"ê¸°íšŒ ëŒ€ê¸° ì¤‘"},
     {asset:"ê¸€ë¡œë²Œ ë¶„ì‚°",stance:"LONG",size:55,note:"ì§€ë¦¬ì  ë¶„ì‚°"},
     {asset:"íŠ¹ìˆ˜ìƒí™©",stance:"ACTIVE",size:65,note:"êµ¬ì¡°ì¡°ì • ê¸°íšŒ"},
   ],color:"#ff8c00",regime:"ì•ˆì „ ìš°ì„ Â·ê°€ì¹˜"},
  {name:"Soros Fund",aum:"$25B",founder:"George Soros",style:"ê¸€ë¡œë²Œ ë§¤í¬ë¡œ",
   positions:[
     {asset:"FX ì£¼ìš”í†µí™”",stance:"ACTIVE",size:70,note:"ë‹¬ëŸ¬ ì•½ì„¸ ë² íŒ…"},
     {asset:"ì‹ í¥ì‹œì¥",stance:"CAUTIOUS",size:38,note:"ì§€ì •í•™ ë¦¬ìŠ¤í¬"},
     {asset:"ìœ ëŸ½ì£¼ì‹",stance:"UNDERWEIGHT",size:30,note:"ì„±ì¥ ë‘”í™” ìš°ë ¤"},
     {asset:"ê¸ˆ",stance:"LONG",size:72,note:"ë‹¬ëŸ¬ í—¤ì§€"},
     {asset:"ë¯¸êµ­ ë‹¨ê¸°ì±„",stance:"LONG",size:80,note:"ê³ ê¸ˆë¦¬ í™œìš©"},
   ],color:"#ff4081",regime:"ê¸€ë¡œë²Œ ë§¤í¬ë¡œÂ·FX"},
  {name:"Pershing Square",aum:"$18B",founder:"Bill Ackman",style:"ì•¡í‹°ë¹„ìŠ¤íŠ¸Â·ì§‘ì¤‘íˆ¬ì",
   positions:[
     {asset:"US ëŒ€í˜•ì£¼",stance:"CONCENTRATED",size:78,note:"ì†Œìˆ˜ ì¢…ëª© ì§‘ì¤‘"},
     {asset:"ê¸ˆë¦¬ ì˜µì…˜",stance:"LONG RATES",size:68,note:"ê¸ˆë¦¬ ìƒìŠ¹ ë² íŒ…"},
     {asset:"ë ˆìŠ¤í† ë‘ì²´ì¸",stance:"LONG",size:55,note:"ì†Œë¹„ì íšŒë³µ"},
     {asset:"USD",stance:"LONG",size:65,note:"ë‹¬ëŸ¬ ê°•ì„¸ ìœ ì§€"},
     {asset:"ì•¡í‹°ë¹„ìŠ¤íŠ¸",stance:"ACTIVE",size:80,note:"ê¸°ì—… ê²½ì˜ ê°œì…"},
   ],color:"#cddc39",regime:"ì§‘ì¤‘Â·ì•¡í‹°ë¹„ìŠ¤íŠ¸"},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CAPITAL FLOWS (ì§€ì—­ê°„ ìê¸ˆ ì´ë™)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildMonths(n=24){
  const now=new Date(),arr=[];
  for(let i=n-1;i>=0;i--){
    const d=new Date(now.getFullYear(),now.getMonth()-i,1);
    arr.push({label:`${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}`,mo:d.getMonth(),yr:d.getFullYear()});
  }
  return arr;
}
const MONTHS=buildMonths(24);

function sr(seed){let s=seed%2147483647;if(s<=0)s+=2147483646;return()=>{s=s*16807%2147483647;return(s-1)/2147483646;};}
function genFlow(base,phase,trend,n=24){
  const r=sr(Math.round(base*100+phase*10));
  return Array.from({length:n},(_,i)=>Math.round(Math.max(5,base+Math.sin((i/12)*2*Math.PI+phase)*base*.22+(i/n)*trend+(r()-.5)*base*.1)));
}

const FLOWS=[
  {from:"me",  to:"us",   base:280,phase:.2,  trend:+20, label:"ì˜¤ì¼ë‹¬ëŸ¬ ì¬íˆ¬ì",    tier:"xl",color:T.gold},
  {from:"cn",  to:"us",   base:240,phase:.8,  trend:-40, label:"ë¯¸êµ­ì±„ ë³´ìœ (ê°ì†Œ)", tier:"xl",color:"#ff3355"},
  {from:"us",  to:"kr",   base:180,phase:.4,  trend:+30, label:"ë°˜ë„ì²´ íˆ¬ì í™•ëŒ€",  tier:"lg",color:T.accent},
  {from:"us",  to:"tw",   base:165,phase:.6,  trend:+25, label:"TSMC ìë³¸ ìœ ì…",    tier:"lg",color:T.green},
  {from:"jp",  to:"us",   base:210,phase:1.2, trend:-15, label:"ì—”ìºë¦¬ ì²­ì‚° ìœ„í—˜",  tier:"lg",color:T.orange},
  {from:"eu",  to:"us",   base:155,phase:.3,  trend:+10, label:"ì„±ì¥ ê²©ì°¨â†’ë¯¸êµ­í–‰", tier:"lg",color:"#7c6af5"},
  {from:"me",  to:"eu",   base:120,phase:.9,  trend: +5, label:"SWF ìœ ëŸ½ íˆ¬ì",     tier:"md",color:T.gold},
  {from:"latam",to:"us",  base: 95,phase:1.5, trend: -5, label:"ë‹¬ëŸ¬í™” ì•ˆì „ìì‚°",   tier:"md",color:"#ff6b35"},
  {from:"cn",  to:"latam",base: 85,phase:.7,  trend:+20, label:"ì¤‘êµ­ ìì› íˆ¬ì",    tier:"md",color:"#ff3355"},
  {from:"oceania",to:"cn",base: 70,phase:1.1, trend:-10, label:"ì² ê´‘ì„Â·LNG ìˆ˜ì¶œ",   tier:"md",color:T.teal},
  {from:"cn",  to:"eu",   base: 78,phase:.5,  trend: -8, label:"ì¼ëŒ€ì¼ë¡œ íˆ¬ì",      tier:"md",color:"#ff3355"},
  {from:"us",  to:"me",   base: 60,phase:.8,  trend: +5, label:"ë‹¬ëŸ¬ í˜ê·¸ ì§€ì›",    tier:"sm",color:T.accent},
  {from:"kr",  to:"us",   base: 55,phase:2.0, trend:-12, label:"ì™¸êµ­ì¸ ìˆœë§¤ë„",     tier:"sm",color:T.orange},
  {from:"eu",  to:"cn",   base: 48,phase:.4,  trend: -8, label:"ë¬´ì—­ ê²°ì œ",         tier:"sm",color:"#7c6af5"},
  {from:"me",  to:"cn",   base: 72,phase:1.3, trend:+15, label:"ì—ë„ˆì§€ ëŒ€ì¤‘êµ­ ìˆ˜ì¶œ", tier:"md",color:T.gold},
  {from:"jp",  to:"latam",base: 42,phase:1.8, trend: +8, label:"ì¼ë³¸ ì¸í”„ë¼ íˆ¬ì",   tier:"sm",color:T.orange},
].map(f=>({...f,amounts:genFlow(f.base,f.phase,f.trend,24)}));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MACRO CHAIN DATA (ì—°ê²° ê³ ë¦¬)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CHAIN_NODES=[
  {id:"cb",  label:"ì¤‘ì•™ì€í–‰",    sub:"ê¸ˆë¦¬ ê²°ì •",  x:.18,y:.25,color:T.purple,icon:"ğŸ›"},
  {id:"mktrate",label:"ì‹œì¥ê¸ˆë¦¬", sub:"êµ­ì±„ìˆ˜ìµë¥ ", x:.36,y:.18,color:T.accent,icon:"ğŸ“ˆ"},
  {id:"fx",  label:"í™˜ìœ¨",        sub:"FX ì‹œì¥",    x:.55,y:.25,color:T.green, icon:"ğŸ’±"},
  {id:"infl",label:"ì¸í”Œë ˆì´ì…˜",  sub:"ë¬¼ê°€Â·CPI",   x:.18,y:.50,color:T.red,  icon:"ğŸ”¥"},
  {id:"empl",label:"ê³ ìš©Â·ì„±ì¥",   sub:"GDPÂ·ì‹¤ì—…",  x:.18,y:.75,color:T.lime, icon:"ğŸ‘¥"},
  {id:"geo", label:"ì§€ì •í•™",      sub:"íŒ¨ê¶ŒÂ·ì „ìŸ",  x:.55,y:.50,color:"#ff8c00",icon:"ğŸŒ"},
  {id:"tariff",label:"ê´€ì„¸Â·ê·œì œ", sub:"ë¬´ì—­ì •ì±…",   x:.73,y:.38,color:"#ff6b35",icon:"âš–ï¸"},
  {id:"energy",label:"ì—ë„ˆì§€",    sub:"WTIÂ·ê°€ìŠ¤Â·ì„íƒ„",x:.36,y:.62,color:T.gold,icon:"âš¡"},
  {id:"minerals",label:"ì›ìì¬",  sub:"êµ¬ë¦¬Â·í¬í† ë¥˜Â·ë¦¬íŠ¬",x:.55,y:.75,color:"#b87333",icon:"â›"},
  {id:"equity",label:"ì£¼ì‹ì‹œì¥",  sub:"ì„ ë¬¼Â·ì˜µì…˜",  x:.82,y:.55,color:T.accent,icon:"ğŸ“Š"},
  {id:"bonds",label:"ì±„ê¶Œì‹œì¥",   sub:"êµ­ì±„Â·íšŒì‚¬ì±„",x:.73,y:.75,color:T.green, icon:"ğŸ“‹"},
  {id:"crypto",label:"ì•”í˜¸í™”í",  sub:"BTCÂ·ETH",   x:.82,y:.82,color:"#ff6b6b",icon:"â‚¿"},
];

const CHAIN_EDGES=[
  {from:"cb",   to:"mktrate",label:"ê¸ˆë¦¬ ì „ë‹¬",         weight:3,color:T.purple,desc:"ê¸°ì¤€ê¸ˆë¦¬ ê²°ì •â†’êµ­ì±„ìˆ˜ìµë¥  íŒŒê¸‰"},
  {from:"mktrate",to:"fx",   label:"ê¸ˆë¦¬ì°¨â†’í™˜ìœ¨",       weight:3,color:T.accent,desc:"ê¸ˆë¦¬ì°¨ í™•ëŒ€â†’ê³ ê¸ˆë¦¬ í†µí™” ê°•ì„¸"},
  {from:"cb",   to:"infl",   label:"ê¸ˆë¦¬â†”ì¸í”Œë ˆ",       weight:2,color:T.red,   desc:"ê¸ˆë¦¬ ì¸ìƒâ†’ì¸í”Œë ˆ ì–µì œ"},
  {from:"infl", to:"cb",     label:"ì¸í”Œë ˆâ†’ê¸ˆë¦¬ê²°ì •",   weight:2,color:T.red,   desc:"ì¸í”Œë ˆ ì§€í‘œë¡œ ê¸ˆë¦¬ ê²°ì •"},
  {from:"empl", to:"cb",     label:"ê³ ìš©â†’ê¸ˆë¦¬ê²°ì •",     weight:2,color:T.lime,  desc:"ì‹¤ì—…ë¥ Â·ì„ê¸ˆâ†’Fed ì´ì¤‘ì±…ë¬´"},
  {from:"geo",  to:"tariff", label:"íŒ¨ê¶Œâ†’ê´€ì„¸",         weight:3,color:"#ff8c00",desc:"ë¯¸ì¤‘ íŒ¨ê¶Œì „ìŸâ†’ê´€ì„¸Â·ì œì¬"},
  {from:"tariff",to:"infl",  label:"ê´€ì„¸â†’ì¸í”Œë ˆ",       weight:2,color:"#ff6b35",desc:"ê´€ì„¸ ë¶€ê³¼â†’ìˆ˜ì…ë¬¼ê°€ ìƒìŠ¹"},
  {from:"geo",  to:"energy", label:"ì§€ì •í•™â†’ì—ë„ˆì§€ê°€ê²©", weight:3,color:"#ff8c00",desc:"ë¶„ìŸÂ·ì œì¬â†’ìœ ê°€Â·ê°€ìŠ¤ ê¸‰ë“±"},
  {from:"energy",to:"infl",  label:"ì—ë„ˆì§€â†’ì¸í”Œë ˆ",     weight:2,color:T.gold,  desc:"ìœ ê°€ ìƒìŠ¹â†’ì „ë°˜ì  ë¬¼ê°€ ì••ë ¥"},
  {from:"minerals",to:"equity",label:"í¬í† ë¥˜â†’ë°˜ë„ì²´",   weight:2,color:"#b87333",desc:"ì›ìì¬ ê³µê¸‰â†’ê¸°ì—… ìƒì‚°ë¹„"},
  {from:"fx",   to:"equity", label:"í™˜ìœ¨â†’ì£¼ì‹",         weight:2,color:T.green, desc:"í†µí™” ê°•ì„¸â†’ìˆ˜ì¶œê¸°ì—… ì‹¤ì "},
  {from:"mktrate",to:"bonds",label:"ê¸ˆë¦¬â†’ì±„ê¶Œ",         weight:3,color:T.accent,desc:"ê¸ˆë¦¬ ìƒìŠ¹â†’ì±„ê¶Œ ê°€ê²© í•˜ë½"},
  {from:"mktrate",to:"equity",label:"ê¸ˆë¦¬â†’ì£¼ì‹ë°¸ë¥˜ì—ì´ì…˜",weight:2,color:T.accent,desc:"í• ì¸ìœ¨ ë³€í™”â†’ì£¼ê°€ ì¡°ì •"},
  {from:"equity",to:"crypto",label:"ë¦¬ìŠ¤í¬ì˜¨â†’í¬ë¦½í† ",   weight:2,color:T.accent,desc:"ìœ„í—˜ ì„ í˜¸ë„â†’BTC ì—°ë™"},
  {from:"geo",  to:"minerals",label:"í¬í† ë¥˜ ì „ìŸ",      weight:3,color:"#ff8c00",desc:"ì¤‘êµ­ í¬í† ë¥˜ ìˆ˜ì¶œê·œì œÂ·ìì›ë¬´ê¸°í™”"},
  {from:"tariff",to:"fx",    label:"ê´€ì„¸â†’í™˜ìœ¨",         weight:2,color:"#ff6b35",desc:"ë¬´ì—­ì „ìŸâ†’í†µí™” ì ˆí•˜ ê²½ìŸ"},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORLD MAP PATHS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const MAP_PATHS=[
  {d:"M 65,80 L 88,65 L 112,62 L 142,67 L 172,75 L 192,82 L 214,88 L 236,98 L 255,108 L 260,122 L 252,138 L 240,152 L 225,170 L 208,192 L 196,210 L 186,222 L 172,228 L 156,224 L 142,210 L 128,200 L 112,182 L 98,164 L 82,144 L 68,120 L 58,100 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 186,230 L 202,224 L 218,230 L 222,242 L 210,248 L 196,238 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 190,252 L 222,246 L 252,254 L 270,272 L 278,302 L 274,338 L 262,374 L 242,408 L 220,424 L 198,420 L 180,406 L 168,372 L 160,336 L 158,298 L 164,268 L 178,254 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 232,28 L 268,22 L 292,34 L 298,56 L 278,68 L 250,70 L 230,56 Z",fill:"#0c1828",stroke:"#162440"},
  {d:"M 428,65 L 462,58 L 494,62 L 524,70 L 542,82 L 546,98 L 532,112 L 512,122 L 490,128 L 466,124 L 446,112 L 432,96 L 425,80 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 465,44 L 488,38 L 512,44 L 518,58 L 496,64 L 470,62 Z",fill:"#0c1828",stroke:"#162440"},
  {d:"M 450,156 L 492,150 L 532,152 L 564,162 L 586,186 L 592,220 L 588,262 L 572,316 L 550,366 L 524,406 L 498,418 L 472,412 L 448,382 L 432,336 L 426,286 L 424,236 L 430,194 L 438,168 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 558,155 L 596,150 L 618,162 L 622,184 L 602,200 L 574,204 L 556,190 L 548,170 Z",fill:"#0c1828",stroke:"#162440"},
  {d:"M 535,34 L 625,24 L 728,18 L 830,22 L 890,36 L 918,58 L 908,82 L 872,96 L 832,104 L 790,108 L 748,106 L 710,102 L 668,98 L 630,94 L 592,88 L 556,80 L 534,66 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 610,110 L 664,114 L 708,120 L 748,128 L 778,142 L 788,162 L 770,180 L 742,190 L 706,192 L 668,186 L 636,174 L 614,158 L 608,138 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 636,162 L 670,158 L 696,166 L 706,190 L 700,220 L 680,244 L 658,248 L 636,236 L 622,212 L 618,188 L 626,172 Z",fill:"#0c1828",stroke:"#162440"},
  {d:"M 748,172 L 782,166 L 806,176 L 814,198 L 802,216 L 774,220 L 750,208 L 740,190 Z",fill:"#0c1828",stroke:"#162440"},
  {d:"M 760,92 L 844,88 L 884,98 L 894,118 L 876,136 L 844,142 L 808,138 L 776,128 L 756,112 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 878,90 L 898,86 L 910,100 L 902,116 L 884,118 L 870,105 Z",fill:"#0c1828",stroke:"#162440"},
  {d:"M 752,302 L 824,292 L 868,300 L 888,326 L 886,364 L 862,392 L 826,406 L 786,398 L 758,374 L 742,340 L 740,316 Z",fill:"#0e1e32",stroke:"#1e3050"},
  {d:"M 906,358 L 922,350 L 932,366 L 922,380 L 908,374 Z",fill:"#0c1828",stroke:"#162440"},
];


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITY COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function TV({type,opts,height}){
  const ref=useRef(null);const uid=useRef("tv_"+Math.random().toString(36).slice(2));
  useEffect(()=>{
    if(!ref.current)return;ref.current.innerHTML="";
    const w=document.createElement("div");w.id=uid.current;ref.current.appendChild(w);
    const s=document.createElement("script");s.src=`https://s3.tradingview.com/external-embedding/embed-widget-${type}.js`;s.async=true;
    s.innerHTML=JSON.stringify({...opts,container_id:uid.current,width:"100%",height,colorTheme:"dark",locale:"kr",isTransparent:true});
    w.appendChild(s);return()=>{if(ref.current)ref.current.innerHTML="";};
  },[]);
  return <div ref={ref} style={{width:"100%",height,overflow:"hidden"}}/>;
}

function Spark({data,width=80,height=26}){
  if(!data||data.length<2)return null;
  const mn=Math.min(...data),mx=Math.max(...data),rng=mx-mn||1;
  const pts=data.map((v,i)=>`${(i/(data.length-1))*width},${height-((v-mn)/rng)*(height-4)-2}`).join(" ");
  const up=data[data.length-1]>=data[0];const lc=up?T.green:T.red;
  return(
    <svg width={width} height={height} style={{display:"block",flexShrink:0}}>
      <polyline points={pts} fill="none" stroke={lc} strokeWidth="1.5" strokeLinejoin="round" strokeLinecap="round"/>
      <circle cx={(data.length-1)/(data.length-1)*width} cy={height-((data[data.length-1]-mn)/rng)*(height-4)-2} r="2.5" fill={lc}/>
    </svg>
  );
}

function ScoreRing({score,size=48,label}){
  const col=score>65?T.green:score>45?T.gold:T.red;
  const r=size/2-5,circ=2*Math.PI*r,dash=(score/100)*circ;
  return(
    <div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:2}}>
      <svg width={size} height={size}>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={T.dim} strokeWidth="3.5"/>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={col} strokeWidth="3.5"
          strokeDasharray={`${dash} ${circ}`} strokeDashoffset={circ/4} strokeLinecap="round"/>
        <text x={size/2} y={size/2+4} textAnchor="middle" fill={col} fontSize={size>44?"11":"9"} fontWeight="700" fontFamily="JetBrains Mono">{score}</text>
      </svg>
      {label&&<span style={{fontSize:7,color:T.muted,fontFamily:"JetBrains Mono",textAlign:"center"}}>{label}</span>}
    </div>
  );
}

function Panel({title,accent,badge,children,style}){
  const ac=accent||T.accent;
  return(
    <div style={{background:T.panel,border:`1px solid ${T.border}`,borderRadius:6,overflow:"hidden",...style}}>
      <div style={{padding:"7px 14px",borderBottom:`1px solid ${T.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",background:T.panel2}}>
        <div style={{display:"flex",alignItems:"center",gap:8}}>
          <div style={{width:2.5,height:16,background:ac,borderRadius:2,flexShrink:0}}/>
          <span style={{fontFamily:"Space Grotesk",fontSize:11,fontWeight:700,color:ac,letterSpacing:".08em",textTransform:"uppercase"}}>{title}</span>
        </div>
        {badge}
      </div>
      {children}
    </div>
  );
}

function Badge({children,color}){
  const c=color||T.muted;
  return <span style={{fontSize:8,color:c,background:c+"20",padding:"2px 8px",borderRadius:2,fontFamily:"JetBrains Mono",fontWeight:700,border:`1px solid ${c}44`}}>{children}</span>;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB 1: WORLD MAP â€” 9ê°œ ì§€ì—­ + ìê¸ˆíë¦„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB 1: WORLD MAP v2 â€” ìê¸ˆ íë¦„ ë¼ì¸ ê°•í™” + ì¸ì‚¬ì´íŠ¸ íŒ¨ë„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function WorldMapView(){
  const [moIdx,setMoIdx]=useState(MONTHS.length-1);
  const [playing,setPlaying]=useState(false);
  const [speed,setSpeed]=useState(1.0);
  const [selRegion,setSelRegion]=useState(null);
  const [hover,setHover]=useState(null);
  const [viewMode,setViewMode]=useState("map"); // "map" | "flowlines" | "sankey"
  const [tick,setTick]=useState(0);
  const playRef=useRef(null);

  useEffect(()=>{if(playing){playRef.current=setInterval(()=>setMoIdx(m=>(m+1)%MONTHS.length),Math.round(1000/speed));}return()=>clearInterval(playRef.current);},[playing,speed]);
  useEffect(()=>{const iv=setInterval(()=>setTick(t=>t+1),55);return()=>clearInterval(iv);},[]);

  const flows=useMemo(()=>FLOWS.map(f=>({...f,amt:f.amounts[moIdx]})),[moIdx]);
  const maxAmt=useMemo(()=>Math.max(...flows.map(f=>f.amt)),[flows]);
  const curMo=MONTHS[moIdx];
  const totalFlow=flows.reduce((s,f)=>s+f.amt,0);

  // Particle system
  const particles=useRef([]);
  useEffect(()=>{
    particles.current=flows.flatMap((f,fi)=>{
      const cnt=f.tier==="xl"?12:f.tier==="lg"?8:f.tier==="md"?5:3;
      const normW=f.amt/maxAmt;
      return Array.from({length:Math.round(cnt*(0.4+normW*.8))},(_,i)=>({
        id:`${fi}-${i}-${moIdx}`,from:f.from,to:f.to,color:f.color,
        speed:(.035+Math.random()*.07)*speed*(0.5+normW*.7),
        maxR:(f.tier==="xl"?7:f.tier==="lg"?5:f.tier==="md"?3.5:2.2)*(0.5+normW*.6),
        startProg:Math.random(),opacity:.5+normW*.45,
      }));
    });
  },[moIdx,speed]);

  function nodePos(rid){const r=REGIONS.find(x=>x.id===rid);return r?{x:r.mapX,y:r.mapY}:{x:.5,y:.5};}

  function FloatParticle({p}){
    const prog=useRef(p.startProg);const[pos,setPos]=useState(p.startProg);
    useEffect(()=>{let raf,last=performance.now();const t=now=>{prog.current=(prog.current+(now-last)/1000*p.speed)%1;last=now;setPos(prog.current);raf=requestAnimationFrame(t);};raf=requestAnimationFrame(t);return()=>cancelAnimationFrame(raf);},[p.speed]);
    const f=nodePos(p.from),t2=nodePos(p.to);
    const cx=f.x+(t2.x-f.x)*pos,cy=f.y+(t2.y-f.y)*pos;
    const r=p.maxR*(0.3+(1-Math.abs(pos-.5)*2)*.7);
    return <circle cx={`${cx*100}%`} cy={`${cy*100}%`} r={r} fill={p.color} opacity={p.opacity*(0.3+pos*.7)}/>;
  }

  // FLOW LINES VIEW â€” ëŒ€í˜• ë¼ì¸ + ë ˆì´ë¸”
  function FlowLinesView(){
    const sorted=[...flows].sort((a,b)=>b.amt-a.amt);
    const max=sorted[0]?.amt||1;
    const W=900,H=480;
    const tierColor={xl:"#00d4ff",lg:"#f0b429",md:"#00e676",sm:"#bb86fc"};

    return(
      <div style={{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"}}>
        <svg width="100%" height="100%" viewBox={`0 0 ${W} ${H}`} preserveAspectRatio="xMidYMid meet" style={{display:"block"}}>
          <defs>
            <radialGradient id="flBg" cx="50%" cy="50%" r="70%"><stop offset="0%" stopColor="#060c18"/><stop offset="100%" stopColor="#04060d"/></radialGradient>
            <filter id="flGlow"><feGaussianBlur stdDeviation="5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          </defs>
          <rect width={W} height={H} fill="url(#flBg)"/>

          {/* ê²©ì */}
          {Array.from({length:9},(_,i)=><line key={i} x1={(i+1)*90} y1="0" x2={(i+1)*90} y2={H} stroke="#0a1428" strokeWidth=".5"/>)}
          {Array.from({length:5},(_,i)=><line key={i} x1="0" y1={(i+1)*80} x2={W} y2={(i+1)*80} stroke="#0a1428" strokeWidth=".5"/>)}

          {/* ì¤‘ì•™ ì„¸ë¡œì„ : ê¸°ì¤€ êµ¬ë¶„ */}
          <line x1={W/2} y1="20" x2={W/2} y2={H-20} stroke="#1c3050" strokeWidth="1" strokeDasharray="6 4"/>
          <text x={W/2} y="16" textAnchor="middle" fill="#1c3050" fontSize="9" fontFamily="JetBrains Mono">ìê¸ˆ íë¦„ ê¸°ì¤€ì„ </text>

          {/* ê° íë¦„ ìˆ˜í‰ ë°” í˜•ì‹ â€” ì™¼ìª½=ì¶œë°œì§€, ì˜¤ë¥¸ìª½=ë„ì°©ì§€ */}
          {sorted.map((f,i)=>{
            const fr=REGIONS.find(r=>r.id===f.from),tr=REGIONS.find(r=>r.id===f.to);
            if(!fr||!tr)return null;
            const y=30+i*(H-60)/Math.min(sorted.length,14);
            const barW=(f.amt/max)*(W*.36);
            const cx=W/2;
            const col=f.color;
            const isH=hover===`${f.from}-${f.to}`;
            const lw=isH?Math.max((f.amt/max)*22,8):Math.max((f.amt/max)*16,4);
            const prev=moIdx>0?f.amounts[moIdx-1]:f.amounts[0];const delta=f.amt-prev;
            if(i>=14)return null;
            return(
              <g key={`${f.from}-${f.to}`}
                onMouseEnter={()=>setHover(`${f.from}-${f.to}`)}
                onMouseLeave={()=>setHover(null)}>
                {/* ê¸€ë¡œìš° */}
                {isH&&<line x1={cx-barW} y1={y+lw/2} x2={cx} y2={y+lw/2} stroke={col} strokeWidth={lw*2.5} strokeOpacity=".08" filter="url(#flGlow)" strokeLinecap="round"/>}
                {/* ë©”ì¸ ë¼ì¸ */}
                <line x1={cx-barW} y1={y+lw/2} x2={cx} y2={y+lw/2}
                  stroke={col} strokeWidth={lw} strokeOpacity={isH?.95:.55+(f.amt/max)*.35} strokeLinecap="round"/>
                {/* í™”ì‚´í‘œ ë */}
                <polygon points={`${cx+2},${y+lw/2} ${cx-12},${y} ${cx-12},${y+lw}`} fill={col} opacity={isH?1:.7}/>
                {/* ì¶œë°œ ë ˆì´ë¸” */}
                <text x={cx-barW-6} y={y+lw/2+4} textAnchor="end" fill={fr.color} fontSize={isH?10:9} fontWeight="700" fontFamily="JetBrains Mono">{fr.flag} {fr.name}</text>
                {/* ë„ì°© ë ˆì´ë¸” */}
                <text x={cx+18} y={y+lw/2+4} textAnchor="start" fill={tr.color} fontSize={isH?10:9} fontWeight="700" fontFamily="JetBrains Mono">{tr.flag} {tr.name}</text>
                {/* ê¸ˆì•¡ */}
                <text x={cx-barW/2} y={y+lw/2-(lw/2+4)} textAnchor="middle" fill={col} fontSize={isH?11:9} fontWeight="700" fontFamily="JetBrains Mono">${f.amt}B</text>
                {/* ë³€í™”ëŸ‰ */}
                <text x={cx-barW/2} y={y+lw/2+(lw/2+12)} textAnchor="middle" fill={delta>=0?T.green:T.red} fontSize="8" fontFamily="JetBrains Mono">{delta>=0?"â–²":"â–¼"}${Math.abs(delta)}B</text>
                {/* ë ˆì´ë¸” */}
                {isH&&<text x={cx-barW/2} y={y+lw/2+4} textAnchor="middle" fill="#fff" fontSize="8" fontFamily="JetBrains Mono" opacity=".8">{f.label}</text>}
                {/* í‹°ì–´ ë°°ì§€ */}
                <rect x={cx-barW-62} y={y} width={22} height={12} rx="2" fill={tierColor[f.tier]+"30"} stroke={tierColor[f.tier]+"66"}/>
                <text x={cx-barW-51} y={y+9} textAnchor="middle" fill={tierColor[f.tier]} fontSize="7.5" fontWeight="700" fontFamily="JetBrains Mono">{f.tier.toUpperCase()}</text>
              </g>
            );
          })}

          {/* ë²”ë¡€ */}
          <rect x={W-120} y="10" width="110" height="60" rx="3" fill="#04060d" opacity=".9"/>
          <text x={W-65} y="25" textAnchor="middle" fill={T.muted} fontSize="8.5" fontFamily="JetBrains Mono" fontWeight="700">TIER ë²”ë¡€</text>
          {[["XL",">$200B","#00d4ff"],["LG","$100~200B","#f0b429"],["MD","$50~100B","#00e676"],["SM","<$50B","#bb86fc"]].map(([t,rng,c],i)=>(
            <g key={t} transform={`translate(${W-118},${32+i*9})`}>
              <rect x="0" y="0" width="18" height="7" rx="1.5" fill={c} opacity=".6"/>
              <text x="22" y="7" fill={c} fontSize="7.5" fontFamily="JetBrains Mono">{t}: {rng}</text>
            </g>
          ))}
        </svg>
      </div>
    );
  }

  // SANKEY (ì§€ì—­ë³„ ìˆœìœ ì¶œì… ë¹„êµ)
  function SankeyView(){
    const regionStats=REGIONS.map(r=>({
      ...r,
      inflow:flows.filter(f=>f.to===r.id).reduce((s,f)=>s+f.amt,0),
      outflow:flows.filter(f=>f.from===r.id).reduce((s,f)=>s+f.amt,0),
    })).map(r=>({...r,net:r.inflow-r.outflow}));
    const maxVal=Math.max(...regionStats.map(r=>Math.max(r.inflow,r.outflow)));

    return(
      <div style={{flex:1,overflowY:"auto",padding:"12px 16px"}}>
        <div style={{fontSize:9,color:T.muted,fontFamily:"JetBrains Mono",fontWeight:700,marginBottom:10,letterSpacing:".1em"}}>
          ì§€ì—­ë³„ ìê¸ˆ ìœ ì¶œì… ë¹„êµ Â· {curMo.label}
        </div>
        {regionStats.map(r=>{
          const inW=(r.inflow/maxVal)*100,outW=(r.outflow/maxVal)*100;
          const net=r.net;
          return(
            <div key={r.id} style={{marginBottom:10,padding:"10px 12px",background:T.panel,borderRadius:5,border:`1px solid ${r.color}33`}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                <div style={{display:"flex",alignItems:"center",gap:8}}>
                  <span style={{fontSize:18}}>{r.flag}</span>
                  <span style={{fontSize:12,color:r.color,fontWeight:700,fontFamily:"Space Grotesk"}}>{r.name}</span>
                </div>
                <span style={{fontSize:13,fontWeight:700,color:net>0?T.green:T.red,fontFamily:"JetBrains Mono"}}>
                  {net>0?"+":""}${Math.round(net)}B ìˆœ{net>0?"ìœ ì…":"ìœ ì¶œ"}
                </span>
              </div>
              <div style={{marginBottom:4}}>
                <div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}>
                  <span style={{fontSize:8,color:T.green,fontFamily:"JetBrains Mono"}}>ìœ ì… ${r.inflow}B</span>
                  <span style={{fontSize:8,color:T.red,fontFamily:"JetBrains Mono"}}>ìœ ì¶œ ${r.outflow}B</span>
                </div>
                <div style={{position:"relative",height:14,background:T.dim,borderRadius:7,overflow:"hidden"}}>
                  <div style={{position:"absolute",left:0,top:0,width:`${inW}%`,height:"100%",background:`linear-gradient(90deg,${T.green}99,${T.green})`,borderRadius:"7px 0 0 7px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:4}}>
                    {inW>15&&<span style={{fontSize:7,color:"#fff",fontWeight:700,fontFamily:"JetBrains Mono"}}>${r.inflow}B</span>}
                  </div>
                  <div style={{position:"absolute",left:`${inW}%`,top:0,width:`${outW*(100-inW)/100}%`,height:"100%",background:`linear-gradient(90deg,${T.red}99,${T.red})`,display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:4}}>
                    {outW>20&&<span style={{fontSize:7,color:"#fff",fontWeight:700,fontFamily:"JetBrains Mono"}}>${r.outflow}B</span>}
                  </div>
                </div>
              </div>
              <div style={{display:"flex",flexWrap:"wrap",gap:4,marginTop:4}}>
                {flows.filter(f=>f.to===r.id).slice(0,3).map((f,i)=>{
                  const fr2=REGIONS.find(x=>x.id===f.from);
                  return<span key={i} style={{fontSize:7,color:T.green,background:T.green+"12",padding:"1px 6px",borderRadius:2,fontFamily:"JetBrains Mono"}}>â† {fr2?.name} ${f.amt}B</span>;
                })}
                {flows.filter(f=>f.from===r.id).slice(0,3).map((f,i)=>{
                  const tr2=REGIONS.find(x=>x.id===f.to);
                  return<span key={i} style={{fontSize:7,color:T.red,background:T.red+"12",padding:"1px 6px",borderRadius:2,fontFamily:"JetBrains Mono"}}>â†’ {tr2?.name} ${f.amt}B</span>;
                })}
              </div>
            </div>
          );
        })}
      </div>
    );
  }

  return(
    <div style={{display:"flex",flexDirection:"column",height:"100%"}}>
      {/* ì»¨íŠ¸ë¡¤ ë°” */}
      <div style={{padding:"7px 14px",background:T.panel2,borderBottom:`1px solid ${T.border}`,display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}}>
        {/* ë·° ëª¨ë“œ */}
        <div style={{display:"flex",gap:3,flexShrink:0}}>
          <button className={`btn${viewMode==="map"?" a":""}`} onClick={()=>setViewMode("map")}>ğŸ—º ì„¸ê³„ì§€ë„</button>
          <button className={`btn${viewMode==="flowlines"?" ga":""}`} onClick={()=>setViewMode("flowlines")}>ğŸ“ ìê¸ˆíë¦„ ë¼ì¸</button>
          <button className={`btn${viewMode==="sankey"?" pa":""}`} onClick={()=>setViewMode("sankey")}>âš– ìœ ì¶œì… ë¹„êµ</button>
        </div>
        <div style={{width:1,height:20,background:T.border,flexShrink:0}}/>
        {/* ì¬ìƒ */}
        {viewMode!=="sankey"&&<>
          <button onClick={()=>setPlaying(p=>!p)} style={{width:28,height:28,borderRadius:"50%",border:`1px solid ${playing?T.accent:T.border}`,background:playing?T.accent+"20":"transparent",color:playing?T.accent:T.muted,fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
            {playing?"â¸":"â–¶"}
          </button>
          <div style={{flex:1,minWidth:160}}>
            <div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}>
              {MONTHS.filter((_,i)=>i%6===0).map((m,i)=><span key={i} style={{fontSize:7,color:T.dim,fontFamily:"JetBrains Mono"}}>{m.label}</span>)}
            </div>
            <input type="range" min="0" max={MONTHS.length-1} value={moIdx} onChange={e=>{setMoIdx(+e.target.value);setPlaying(false);}}/>
          </div>
          <div style={{flexShrink:0}}>
            <div style={{fontSize:14,fontWeight:700,color:T.accent,fontFamily:"Space Grotesk"}}>{curMo.label}</div>
            <div style={{fontSize:7.5,color:T.muted,fontFamily:"JetBrains Mono"}}>ì´ ${(totalFlow/1000).toFixed(2)}T</div>
          </div>
          <div style={{flexShrink:0,minWidth:80}}>
            <div style={{display:"flex",justifyContent:"space-between",fontSize:7.5,color:T.muted,fontFamily:"JetBrains Mono",marginBottom:2}}>
              <span>ì†ë„</span><span style={{color:T.gold}}>{speed.toFixed(1)}Ã—</span>
            </div>
            <input type="range" min=".3" max="5" step=".1" value={speed} onChange={e=>setSpeed(+e.target.value)}/>
          </div>
        </>}
        {/* ìš”ì•½ */}
        <div style={{marginLeft:"auto",display:"flex",gap:12,fontSize:8.5,fontFamily:"JetBrains Mono"}}>
          <span>ìµœëŒ€ìœ ì…: <span style={{color:T.green,fontWeight:700}}>{REGIONS.reduce((a,r)=>{const v=flows.filter(f=>f.to===r.id).reduce((s,f)=>s+f.amt,0);return v>a.v?{n:r.name,v}:a;},{n:"",v:0}).n}</span></span>
          <span>ìµœëŒ€ìœ ì¶œ: <span style={{color:T.red,fontWeight:700}}>{REGIONS.reduce((a,r)=>{const v=flows.filter(f=>f.from===r.id).reduce((s,f)=>s+f.amt,0);return v>a.v?{n:r.name,v}:a;},{n:"",v:0}).n}</span></span>
        </div>
      </div>

      {viewMode==="sankey"&&<SankeyView/>}
      {viewMode==="flowlines"&&(
        <div style={{flex:1,display:"flex",overflow:"hidden"}}>
          <FlowLinesView/>
          {/* ì¸ì‚¬ì´íŠ¸ ì‚¬ì´ë“œ */}
          <div style={{width:230,borderLeft:`1px solid ${T.border}`,overflowY:"auto",background:T.panel2,padding:"10px"}}>
            <div style={{fontSize:9,color:T.muted,fontFamily:"JetBrains Mono",fontWeight:700,marginBottom:8,letterSpacing:".1em"}}>ğŸ’¡ FLOW INSIGHTS</div>
            {[...flows].sort((a,b)=>b.amt-a.amt).slice(0,8).map((f,i)=>{
              const fr=REGIONS.find(r=>r.id===f.from),tr=REGIONS.find(r=>r.id===f.to);
              const prev=moIdx>0?f.amounts[moIdx-1]:f.amounts[0];
              const delta=f.amt-prev,chg=((delta/prev)*100).toFixed(1);
              return(
                <div key={i} style={{padding:"8px 9px",background:T.panel,borderRadius:4,marginBottom:5,border:`1px solid ${f.color}33`}}>
                  <div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}>
                    <span style={{fontSize:8.5,color:f.color,fontWeight:700,fontFamily:"JetBrains Mono"}}>{fr?.name}â†’{tr?.name}</span>
                    <span style={{fontSize:9,color:delta>=0?T.green:T.red,fontFamily:"JetBrains Mono",fontWeight:700}}>{delta>=0?"â–²":"â–¼"}{Math.abs(chg)}%</span>
                  </div>
                  <div style={{fontSize:13,color:T.text,fontWeight:700,fontFamily:"JetBrains Mono",marginBottom:2}}>${f.amt}B</div>
                  <div style={{height:2,background:T.dim,borderRadius:1}}><div style={{width:`${(f.amt/flows[0]?.amt||1)*100}%`,height:"100%",background:f.color}}/></div>
                  <div style={{fontSize:7,color:T.dim,fontFamily:"JetBrains Mono",marginTop:3}}>{f.label}</div>
                </div>
              );
            })}
          </div>
        </div>
      )}
      {viewMode==="map"&&(
        <div style={{flex:1,display:"flex",minHeight:0}}>
          {/* ì§€ë„ ë©”ì¸ */}
          <div style={{flex:1,position:"relative",background:T.bg,overflow:"hidden"}}>
            <svg width="100%" height="100%" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid slice" style={{display:"block"}}>
              <defs>
                <filter id="glow"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                <filter id="glowLg"><feGaussianBlur stdDeviation="6" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
              </defs>
              {/* ë°”ë‹¤ */}
              <rect width="1000" height="500" fill="#04060d"/>
              {/* ê·¸ë¦¬ë“œ */}
              {Array.from({length:20},(_,i)=><line key={i} x1={i*50} y1="0" x2={i*50} y2="500" stroke="#0c1420" strokeWidth=".5"/>)}
              {Array.from({length:10},(_,i)=><line key={i} x1="0" y1={i*50} x2="1000" y2={i*50} stroke="#0c1420" strokeWidth=".5"/>)}

              {/* ìœ¡ì§€ íŒ¨ìŠ¤ */}
              {MAP_PATHS.map((p,i)=><path key={i} d={p.d} fill={p.fill} stroke={p.stroke} strokeWidth=".5"/>)}

              {/* ìê¸ˆ íë¦„ ë¼ì¸ */}
              {flows.map(f=>{
                const from=REGIONS.find(r=>r.id===f.from),to=REGIONS.find(r=>r.id===f.to);
                if(!from||!to)return null;
                const isH=hover===`${f.from}-${f.to}`;
                const x1=from.mapX*1000,y1=from.mapY*500,x2=to.mapX*1000,y2=to.mapY*500;
                const mx=(x1+x2)/2+(y2-y1)*.15,my=(y1+y2)/2-(x2-x1)*.15;
                const sw=(f.tier==="xl"?3.5:f.tier==="lg"?2.2:f.tier==="md"?1.2:0.7)*(0.6+(f.amt/maxAmt)*.8)*(isH?2:1);
                return(
                  <path key={`${f.from}-${f.to}`} d={`M${x1} ${y1} Q${mx} ${my} ${x2} ${y2}`}
                    fill="none" stroke={f.color} strokeWidth={sw} strokeOpacity={isH?.9:.25+(f.amt/maxAmt)*.3}
                    strokeDasharray={f.tier==="xl"?"none":f.tier==="lg"?"8 4":"4 4"}
                    onMouseEnter={()=>setHover(`${f.from}-${f.to}`)} onMouseLeave={()=>setHover(null)} style={{cursor:"pointer"}}/>
                );
              })}

              {/* íŒŒí‹°í´ */}
              {particles.current.map(p=><FloatParticle key={p.id} p={p}/>)}

              {/* ì§€ì—­ ë…¸ë“œ */}
              {REGIONS.map(r=>{
                const isS=selRegion?.id===r.id;const inf=flows.filter(f=>f.to===r.id).reduce((s,f)=>s+f.amt,0);const out=flows.filter(f=>f.from===r.id).reduce((s,f)=>s+f.amt,0);const net=inf-out;
                return(
                  <g key={r.id} transform={`translate(${r.mapX*1000},${r.mapY*500})`} onClick={()=>setSelRegion(r)} style={{cursor:"pointer"}}>
                    <circle r={r.mapR*.6} fill={r.color} opacity=".05"/>
                    <circle r={isS?10:7} fill={T.panel} stroke={r.color} strokeWidth={isS?3:1.5} filter={isS?"url(#glow)":"none"}/>
                    <text y="-14" textAnchor="middle" fill={r.color} fontSize="11" fontWeight="700" fontFamily="Space Grotesk">{r.flag} {r.name}</text>
                    <text y="22" textAnchor="middle" fill={net>=0?T.green:T.red} fontSize="9" fontWeight="700" fontFamily="JetBrains Mono">{net>=0?"+":""}{Math.round(net)}B</text>
                  </g>
                );
              })}
            </svg>

            {/* ì§€ë„ ìœ„ ì˜¤ë²„ë ˆì´ (ì„ íƒëœ ì§€ì—­ ìƒì„¸) */}
            {selRegion&&(
              <div style={{position:"absolute",right:16,top:16,width:260,background:T.panel+"dd",backdropFilter:"blur(10px)",border:`1px solid ${selRegion.color}`,borderRadius:8,padding:14,boxShadow:"0 8px 32px rgba(0,0,0,.5)"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12}}>
                  <div>
                    <div style={{fontSize:18,display:"flex",alignItems:"center",gap:8}}>{selRegion.flag} <span style={{fontSize:14,color:selRegion.color,fontWeight:700}}>{selRegion.en}</span></div>
                    <div style={{fontSize:9,color:T.muted,fontFamily:"JetBrains Mono",marginTop:2}}>REGION DATA TERMINAL</div>
                  </div>
                  <button onClick={()=>setSelRegion(null)} style={{background:"none",border:"none",color:T.muted,cursor:"pointer",fontSize:16}}>Ã—</button>
                </div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12}}>
                  <div style={{background:T.panel2,padding:8,borderRadius:4,border:`1px solid ${T.border}`}}>
                    <div style={{fontSize:7,color:T.muted,fontFamily:"JetBrains Mono"}}>GDP GROWTH</div>
                    <div style={{fontSize:13,fontWeight:700,color:selRegion.gdpGrowth>=0?T.green:T.red}}>{selRegion.gdpGrowth}%</div>
                  </div>
                  <div style={{background:T.panel2,padding:8,borderRadius:4,border:`1px solid ${T.border}`}}>
                    <div style={{fontSize:7,color:T.muted,fontFamily:"JetBrains Mono"}}>CPI (INFL)</div>
                    <div style={{fontSize:13,fontWeight:700,color:T.text}}>{selRegion.cpi}%</div>
                  </div>
                  <div style={{background:T.panel2,padding:8,borderRadius:4,border:`1px solid ${T.border}`}}>
                    <div style={{fontSize:7,color:T.muted,fontFamily:"JetBrains Mono"}}>POLICY RATE</div>
                    <div style={{fontSize:13,fontWeight:700,color:T.purple}}>{selRegion.policyRate}%</div>
                  </div>
                  <div style={{background:T.panel2,padding:8,borderRadius:4,border:`1px solid ${T.border}`}}>
                    <div style={{fontSize:7,color:T.muted,fontFamily:"JetBrains Mono"}}>10Y YIELD</div>
                    <div style={{fontSize:13,fontWeight:700,color:T.accent}}>{selRegion.rate10y}%</div>
                  </div>
                </div>
                <div style={{fontSize:9,color:T.text,lineHeight:1.5,marginBottom:12,padding:"8px",background:selRegion.color+"10",borderRadius:4,borderLeft:`2px solid ${selRegion.color}`}}>{selRegion.description}</div>
                <div style={{fontSize:8,color:T.muted,marginBottom:4,fontWeight:700}}>KEY EVENTS</div>
                <div style={{display:"flex",flexDirection:"column",gap:3}}>
                  {selRegion.keyEvents.map((e,i)=><div key={i} style={{fontSize:8.5,color:T.text,display:"flex",gap:6}}><span style={{color:selRegion.color}}>â€¢</span> {e}</div>)}
                </div>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB 2: MACRO CHAIN â€” ê±°ì‹œ ì§€í‘œ ì—°ê²°ë§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function MacroChainView(){
  const [hoverNode,setHoverNode]=useState(null);
  const [hoverEdge,setHoverEdge]=useState(null);
  const [tick,setTick]=useState(0);
  useEffect(()=>{const iv=setInterval(()=>setTick(t=>t+1),60);return()=>clearInterval(iv);},[]);

  return(
    <div style={{height:"100%",background:T.bg,position:"relative",overflow:"hidden"}}>
      <svg width="100%" height="100%" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet" style={{display:"block"}}>
        <defs>
          <filter id="c-glow"><feGaussianBlur stdDeviation="3.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <marker id="arrow" viewBox="0 0 10 10" refX="28" refY="5" markerWidth="4" markerHeight="4" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" fill={T.dim}/></marker>
          {CHAIN_NODES.map(n=>(
            <marker key={`arr-${n.id}`} id={`arr-${n.id}`} viewBox="0 0 10 10" refX="32" refY="5" markerWidth="3.5" markerHeight="3.5" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" fill={n.color}/></marker>
          ))}
        </defs>

        {/* ë°°ê²½ ê²©ì */}
        <path d="M 0 0 L 1000 0 M 0 100 L 1000 100 M 0 200 L 1000 200 M 0 300 L 1000 300 M 0 400 L 1000 400 M 0 500 L 1000 500" stroke="#0c1420" strokeWidth=".5"/>
        <path d="M 0 0 L 0 600 M 100 0 L 100 600 M 200 0 L 200 600 M 300 0 L 300 600 M 400 0 L 400 600 M 500 0 L 500 600 M 600 0 L 600 600 M 700 0 L 700 600 M 800 0 L 800 600 M 900 0 L 900 600" stroke="#0c1420" strokeWidth=".5"/>

        {/* ì—£ì§€ */}
        {CHAIN_EDGES.map((e,i)=>{
          const f=CHAIN_NODES.find(n=>n.id===e.from),t=CHAIN_NODES.find(n=>n.id===e.to);
          if(!f||!t)return null;
          const isH=hoverEdge===i||hoverNode===e.from||hoverNode===e.to;
          const x1=f.x*1000,y1=f.y*600,x2=t.x*1000,y2=t.y*600;
          const mx=(x1+x2)/2,my=(y1+y2)/2;
          return(
            <g key={i} onMouseEnter={()=>setHoverEdge(i)} onMouseLeave={()=>setHoverEdge(null)}>
              <line x1={x1} y1={y1} x2={x2} y2={y2} stroke={isH?e.color:T.dim} strokeWidth={isH?e.weight*1.5:e.weight*0.8} strokeOpacity={isH?.8:.2} markerEnd={`url(#arr-${t.id})`} style={{transition:"all .2s"}}/>
              {isH&&(
                <g transform={`translate(${mx},${my-10})`}>
                  <rect x="-50" y="-12" width="100" height="18" rx="3" fill={T.panel} stroke={e.color} strokeWidth=".5"/>
                  <text textAnchor="middle" y="1" fill={e.color} fontSize="8.5" fontWeight="700" fontFamily="JetBrains Mono">{e.label}</text>
                </g>
              )}
            </g>
          );
        })}

        {/* ë…¸ë“œ */}
        {CHAIN_NODES.map(n=>{
          const isH=hoverNode===n.id;
          const x=n.x*1000,y=n.y*600;
          const pulse=Math.sin(tick*0.08+x)*2;
          return(
            <g key={n.id} transform={`translate(${x},${y})`} onMouseEnter={()=>setHoverNode(n.id)} onMouseLeave={()=>setHoverNode(null)} style={{cursor:"pointer"}}>
              <circle r={isH?48:42} fill={T.panel} stroke={n.color} strokeWidth={isH?3.5:1.8} filter={isH?"url(#c-glow)":"none"} style={{transition:"all .2s"}}/>
              <circle r={isH?48:42} fill="none" stroke={n.color} strokeWidth="1" strokeOpacity=".2" strokeDasharray="4 4" transform={`scale(${1.15+pulse*0.02})`}/>
              <text y="-8" textAnchor="middle" fill="#fff" fontSize="18" className="blink">{n.icon}</text>
              <text y="14" textAnchor="middle" fill={n.color} fontSize="11" fontWeight="700" fontFamily="Space Grotesk">{n.label}</text>
              <text y="26" textAnchor="middle" fill={T.muted} fontSize="7.5" fontFamily="JetBrains Mono">{n.sub}</text>
            </g>
          );
        })}
      </svg>

      {/* ì •ë³´ íŒ¨ë„ */}
      <div style={{position:"absolute",left:20,bottom:20,width:320,background:T.panel+"cc",backdropFilter:"blur(12px)",border:`1px solid ${T.border}`,borderRadius:6,padding:16}}>
        <div style={{fontSize:11,color:T.accent,fontWeight:700,fontFamily:"Space Grotesk",marginBottom:10,letterSpacing:".1em"}}>CHAIN ANALYSIS ENGINE</div>
        {hoverNode?(
          <div>
            <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
              <span style={{fontSize:24}}>{CHAIN_NODES.find(n=>n.id===hoverNode).icon}</span>
              <div>
                <div style={{fontSize:14,color:CHAIN_NODES.find(n=>n.id===hoverNode).color,fontWeight:700}}>{CHAIN_NODES.find(n=>n.id===hoverNode).label}</div>
                <div style={{fontSize:9,color:T.muted}}>{CHAIN_NODES.find(n=>n.id===hoverNode).sub}</div>
              </div>
            </div>
            <div style={{fontSize:9,color:T.text,lineHeight:1.6,marginBottom:10,background:T.bg+"88",padding:10,borderRadius:4}}>
              ì´ ë…¸ë“œëŠ” ê¸€ë¡œë²Œ ë§¤í¬ë¡œ ìƒíƒœê³„ì—ì„œ {hoverNode==="cb"?"í†µí™” ì •ì±…ì˜ ì •ì ":hoverNode==="geo"?"ì§€ì •í•™ì  ë³€ë™ì„±ì˜ ê·¼ì›":hoverNode==="infl"?"êµ¬ë§¤ë ¥ê³¼ ê¸ˆë¦¬ ê²½ë¡œì˜ í•µì‹¬":"ì£¼ìš”í•œ ì‹¤ì‹œê°„ ì§€í‘œ"} ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê´€ë ¨ ì§€í‘œì˜ ë³€í™”ëŠ” ì—°ê²°ëœ ëª¨ë“  ìì‚°êµ°ì— ì¦‰ê°ì ì¸ íŒŒê¸‰ë ¥ì„ ê°€ì§‘ë‹ˆë‹¤.
            </div>
            <div style={{fontSize:8,color:T.muted,marginBottom:6,fontWeight:700}}>DIRECT INFLUENCES</div>
            <div style={{display:"flex",flexDirection:"column",gap:4}}>
              {CHAIN_EDGES.filter(e=>e.from===hoverNode||e.to===hoverNode).map((e,i)=>(
                <div key={i} style={{fontSize:8,background:e.color+"15",color:T.text,padding:"4px 8px",borderRadius:2,borderLeft:`2px solid ${e.color}`}}>
                  <span style={{fontWeight:700,color:e.color}}>{e.from===hoverNode?`â†’ ${CHAIN_NODES.find(n=>n.id===e.to).label}`:`â† ${CHAIN_NODES.find(n=>n.id===e.from).label}`}</span>: {e.desc}
                </div>
              ))}
            </div>
          </div>
        ):(
          <div style={{fontSize:9,color:T.muted,fontStyle:"italic"}}>ë…¸ë“œ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ì—°ê²°ëœ ë§¤í¬ë¡œ ìƒê´€ê´€ê³„ì™€ íŒŒê¸‰ íš¨ê³¼ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</div>
        )}
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB 3: HEDGE FUNDS â€” í—¤ì§€í€ë“œ í¬ì§€ì…”ë‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function HedgeFundView(){
  const [selFund,setSelFund]=useState(HEDGE_FUNDS[0]);

  return(
    <div style={{display:"flex",height:"100%",background:T.bg}}>
      {/* ì‚¬ì´ë“œë°”: í€ë“œ ë¦¬ìŠ¤íŠ¸ */}
      <div style={{width:240,borderRight:`1px solid ${T.border}`,background:T.panel2,overflowY:"auto"}}>
        <div style={{padding:16,borderBottom:`1px solid ${T.border}`,background:T.bg}}>
          <div style={{fontSize:10,color:T.accent,fontWeight:700,letterSpacing:".1em",fontFamily:"Space Grotesk"}}>SMART MONEY TRACKER</div>
          <div style={{fontSize:8,color:T.muted,marginTop:2}}>ì£¼ìš” í—¤ì§€í€ë“œ ì¶”ì • í¬ì§€ì…”ë‹</div>
        </div>
        {HEDGE_FUNDS.map(f=>(
          <div key={f.name} onClick={()=>setSelFund(f)} style={{padding:"14px 16px",borderBottom:`1px solid ${T.border}`,cursor:"pointer",background:selFund.name===f.name?f.color+"15":T.panel2,borderLeft:selFund.name===f.name?`4px solid ${f.color}`:"4px solid transparent",transition:"all .2s"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
              <span style={{fontSize:13,fontWeight:700,color:selFund.name===f.name?f.color:T.text}}>{f.name}</span>
              <Badge color={f.color}>{f.aum}</Badge>
            </div>
            <div style={{fontSize:8,color:T.muted,fontFamily:"JetBrains Mono"}}>{f.founder} Â· {f.style}</div>
          </div>
        ))}
      </div>

      {/* ë©”ì¸: ìƒì„¸ í¬ì§€ì…˜ */}
      <div style={{flex:1,padding:24,overflowY:"auto"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-end",marginBottom:24,borderBottom:`1px solid ${T.border}`,paddingBottom:16}}>
          <div>
            <div style={{fontSize:32,fontWeight:700,color:selFund.color,fontFamily:"Space Grotesk"}}>{selFund.name}</div>
            <div style={{fontSize:12,color:T.muted,marginTop:4}}>{selFund.founder} / {selFund.style} / AUM {selFund.aum}</div>
          </div>
          <div style={{textAlign:"right"}}>
            <div style={{fontSize:9,color:T.muted,fontFamily:"JetBrains Mono",marginBottom:4}}>CURRENT REGIME</div>
            <div style={{fontSize:14,fontWeight:700,color:T.gold,background:T.gold+"15",padding:"6px 12px",borderRadius:4,border:`1px solid ${T.gold}44`}}>{selFund.regime}</div>
          </div>
        </div>

        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:24}}>
          <Panel title="TOP POSITIONS" accent={selFund.color} style={{background:T.panel2}}>
            <div style={{padding:16}}>
              {selFund.positions.map((p,i)=>(
                <div key={i} style={{marginBottom:16}}>
                  <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
                    <span style={{fontSize:11,fontWeight:700,color:T.text}}>{p.asset}</span>
                    <span style={{fontSize:10,fontWeight:700,color:p.stance==="LONG"||p.stance==="OVERWEIGHT"?T.green:p.stance==="SHORT"||p.stance==="UNDERWEIGHT"?T.red:T.gold}}>{p.stance}</span>
                  </div>
                  <div style={{height:6,background:T.bg,borderRadius:3,overflow:"hidden",marginBottom:4}}>
                    <div style={{width:`${p.size}%`,height:"100%",background:p.stance.includes("LONG")||p.stance.includes("OVER")?T.green:p.stance.includes("SHORT")||p.stance.includes("UNDER")?T.red:T.gold,opacity:.8}}/>
                  </div>
                  <div style={{fontSize:8.5,color:T.muted,fontStyle:"italic"}}>â€” {p.note}</div>
                </div>
              ))}
            </div>
          </Panel>

          <div style={{display:"flex",flexDirection:"column",gap:20}}>
            <Panel title="PORTFOLIO RADAR" accent={selFund.color}>
              <div style={{height:200,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"}}>
                <svg width="180" height="180" viewBox="0 0 100 100">
                  <circle cx="50" cy="50" r="45" fill="none" stroke={T.border} strokeWidth=".5"/>
                  <circle cx="50" cy="50" r="30" fill="none" stroke={T.border} strokeWidth=".5"/>
                  <circle cx="50" cy="50" r="15" fill="none" stroke={T.border} strokeWidth=".5"/>
                  <line x1="50" y1="5" x2="50" y2="95" stroke={T.border} strokeWidth=".5"/>
                  <line x1="5" y1="50" x2="95" y2="50" stroke={T.border} strokeWidth=".5"/>
                  <polygon points={selFund.positions.map((p,i)=>{
                    const r=p.size/100*45;const a=(i/selFund.positions.length)*Math.PI*2-Math.PI/2;
                    return `${50+Math.cos(a)*r},${50+Math.sin(a)*r}`;
                  }).join(" ")} fill={selFund.color} fillOpacity=".2" stroke={selFund.color} strokeWidth="1.5"/>
                  {selFund.positions.map((p,i)=>{
                    const a=(i/selFund.positions.length)*Math.PI*2-Math.PI/2;
                    return <text key={i} x={50+Math.cos(a)*52} y={50+Math.sin(a)*52} textAnchor="middle" fill={T.muted} fontSize="4" fontFamily="JetBrains Mono">{p.asset}</text>;
                  })}
                </svg>
              </div>
            </Panel>
            <div style={{background:T.panel2,borderRadius:6,border:`1px solid ${T.border}`,padding:16}}>
              <div style={{fontSize:10,color:T.accent,fontWeight:700,marginBottom:10}}>INSIGHT ANALYTICS</div>
              <div style={{fontSize:9,color:T.text,lineHeight:1.6}}>
                {selFund.name}ëŠ” í˜„ì¬ <span style={{color:T.gold}}>{selFund.regime}</span> ì „ëµì„ ê³ ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ <span style={{color:T.accent}}>{selFund.positions[0].asset}</span>ì— ëŒ€í•œ ë†’ì€ ë…¸ì¶œë„ëŠ” ê±°ì‹œ ê²½ì œì˜ ë¶ˆí™•ì‹¤ì„±ì„ ë°©ì–´í•˜ë ¤ëŠ” ì˜ë„ë¡œ í’€ì´ë©ë‹ˆë‹¤. ìŠ¤ë§ˆíŠ¸ ë¨¸ë‹ˆì˜ íë¦„ì€ ê°œì¸ íˆ¬ììë³´ë‹¤ ì•½ 3~6ê°œì›” ì„ í–‰í•˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB 4: CALENDAR & NEWS â€” ê²½ì œ ì§€í‘œ ë° ë‰´ìŠ¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function CalendarView(){
  const {news,calendar}=useLive();
  const [filter,setFilter]=useState("ALL");

  const filteredCal=calendar.filter(e=>{
    if(filter==="ALL")return true;
    return e.country===filter;
  });

  return(
    <div style={{display:"flex",height:"100%",background:T.bg}}>
      <div style={{flex:1,borderRight:`1px solid ${T.border}`,display:"flex",flexDirection:"column"}}>
        <div style={{padding:"12px 16px",borderBottom:`1px solid ${T.border}`,background:T.panel2,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div style={{display:"flex",alignItems:"center",gap:8}}>
            <div style={{width:3,height:18,background:T.accent,borderRadius:2}}/>
            <span style={{fontSize:12,fontWeight:700,color:T.accent,fontFamily:"Space Grotesk"}}>ECONOMIC CALENDAR</span>
          </div>
          <select value={filter} onChange={e=>setFilter(e.target.value)} style={{background:T.bg,color:T.text,border:`1px solid ${T.border}`,fontSize:10,padding:"2px 8px",borderRadius:3}}>
            <option value="ALL">ALL COUNTRIES</option>
            <option value="United States">USA</option>
            <option value="China">CHINA</option>
            <option value="Japan">JAPAN</option>
            <option value="Euro Area">EURO AREA</option>
          </select>
        </div>
        <div style={{flex:1,overflowY:"auto"}}>
          <table style={{width:"100%",borderCollapse:"collapse",fontSize:10,fontFamily:"JetBrains Mono"}}>
            <thead style={{position:"sticky",top:0,background:T.bg,zIndex:1}}>
              <tr style={{borderBottom:`1px solid ${T.border}`,color:T.muted,textAlign:"left"}}>
                <th style={{padding:"10px 16px",fontWeight:400}}>TIME (UTC)</th>
                <th style={{padding:"10px 8px",fontWeight:400}}>CUR</th>
                <th style={{padding:"10px 8px",fontWeight:400}}>EVENT</th>
                <th style={{padding:"10px 8px",fontWeight:400}}>ACTUAL</th>
                <th style={{padding:"10px 16px",fontWeight:400,textAlign:"right"}}>EST</th>
              </tr>
            </thead>
            <tbody>
              {filteredCal.map((e,i)=>(
                <tr key={i} style={{borderBottom:`1px solid ${T.border}33`,background:i%2===0?"transparent":T.panel+"33"}}>
                  <td style={{padding:"10px 16px",color:T.muted}}>{e.time.slice(11,16)}</td>
                  <td style={{padding:"10px 8px"}}><Badge color={e.impact==="High"?T.red:T.gold}>{e.country.slice(0,3).toUpperCase()}</Badge></td>
                  <td style={{padding:"10px 8px",color:T.text,fontWeight:e.impact==="High"?700:400}}>{e.event}</td>
                  <td style={{padding:"10px 8px",color:e.actual?T.accent:T.dim}}>{e.actual||"â€”"}</td>
                  <td style={{padding:"10px 16px",textAlign:"right",color:T.muted}}>{e.estimate||"â€”"}</td>
                </tr>
              ))}
              {!filteredCal.length&&<tr><td colSpan="5" style={{padding:40,textAlign:"center",color:T.dim}}>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ê±°ë‚˜ ì˜ˆì •ëœ ì£¼ìš” ì§€í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>}
            </tbody>
          </table>
        </div>
      </div>

      <div style={{width:380,display:"flex",flexDirection:"column",background:T.panel2}}>
        <div style={{padding:"12px 16px",borderBottom:`1px solid ${T.border}`,display:"flex",alignItems:"center",gap:8}}>
          <div style={{width:3,height:18,background:T.red,borderRadius:2}}/>
          <span style={{fontSize:12,fontWeight:700,color:T.red,fontFamily:"Space Grotesk"}}>GLOBAL NEWS STREAM</span>
        </div>
        <div style={{flex:1,overflowY:"auto",padding:16}}>
          {news.map((n,i)=>(
            <a key={i} href={n.url} target="_blank" rel="noopener noreferrer" style={{display:"block",padding:"12px 0",borderBottom:`1px solid ${T.border}44`,textDecoration:"none"}}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
                <span style={{fontSize:8,color:T.accent,fontFamily:"JetBrains Mono"}}>{n.source.toUpperCase()}</span>
                <span style={{fontSize:8,color:T.muted}}>{new Date(n.datetime*1000).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</span>
              </div>
              <div style={{fontSize:11,color:T.text,lineHeight:1.4,fontWeight:500}}>{n.headline}</div>
              <div style={{fontSize:9,color:T.muted,marginTop:6,display:"flex",gap:10}}>
                <span>#Macro</span><span>#Markets</span>
              </div>
            </a>
          ))}
          {!news.length&&<div style={{padding:40,textAlign:"center",color:T.dim}}>ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function App(){
  const [tab,setTab]=useState("world");
  const [liveData,setLiveData]=useState({
    news:[],calendar:[],
    us10y:null,us2y:null,cpi:null,
    oil:null,copper:null,gold:null,
  });

  useEffect(()=>{
    // Initial fetch
    fhNews().then(d=>setLiveData(prev=>({...prev,news:d})));
    fhEconCal().then(d=>setLiveData(prev=>({...prev,calendar:d})));
    fredVal('DGS10').then(v=>setLiveData(prev=>({...prev,us10y:v})));
    fredVal('DGS2').then(v=>setLiveData(prev=>({...prev,us2y:v})));
    fredCpiYoy().then(v=>setLiveData(prev=>({...prev,cpi:v})));
    avComm('WTI').then(v=>setLiveData(prev=>({...prev,oil:v})));
    avComm('COPPER').then(v=>setLiveData(prev=>({...prev,copper:v})));
    avComm('GOLD').then(v=>setLiveData(prev=>({...prev,gold:v})));

    // Polling news every 5m
    const iv=setInterval(()=>fhNews().then(d=>setLiveData(prev=>({...prev,news:d}))),300000);
    return()=>clearInterval(iv);
  },[]);

  return(
    <LiveCtx.Provider value={liveData}>
      <div style={{height:"100vh",display:"flex",flexDirection:"column",background:T.bg,color:T.text,fontFamily:"'Space Grotesk', sans-serif"}}>
        {/* Header */}
        <header style={{height:48,background:T.panel,borderBottom:`1px solid ${T.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 20px",flexShrink:0}}>
          <div style={{display:"flex",alignItems:"center",gap:14}}>
            <div style={{width:22,height:22,background:T.accent,borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",color:T.bg,fontWeight:900,fontSize:14}}>G</div>
            <span style={{fontSize:14,fontWeight:700,letterSpacing:".15em",color:T.accent}}>GLOBAL MACRO INTELLIGENCE <span style={{fontSize:9,color:T.muted,fontWeight:400,marginLeft:8}}>v1.0 (BETA)</span></span>
          </div>
          <div style={{display:"flex",gap:24,fontSize:10,fontFamily:"JetBrains Mono"}}>
            <div style={{display:"flex",gap:8}}><span style={{color:T.muted}}>US10Y:</span><span style={{color:T.accent,fontWeight:700}}>{liveData.us10y||"â€”"}%</span></div>
            <div style={{display:"flex",gap:8}}><span style={{color:T.muted}}>US2Y:</span><span style={{color:T.accent,fontWeight:700}}>{liveData.us2y||"â€”"}%</span></div>
            <div style={{display:"flex",gap:8}}><span style={{color:T.muted}}>CPI(YoY):</span><span style={{color:T.red,fontWeight:700}}>{liveData.cpi||"â€”"}%</span></div>
            <div style={{display:"flex",gap:8}}><span style={{color:T.muted}}>WTI:</span><span style={{color:T.gold,fontWeight:700}}>${liveData.oil||"â€”"}</span></div>
          </div>
        </header>

        {/* Ticker */}
        <div style={{height:36,background:T.bg,borderBottom:`1px solid ${T.border}`,flexShrink:0}}>
          <TV type="ticker-tape" height={36} opts={{
            symbols:[
              {proName:"FOREXCOM:SPXUSD",title:"S&P 500"},{proName:"FOREXCOM:NSXUSD",title:"NASDAQ 100"},
              {proName:"KRX:KOSPI",title:"KOSPI"},{proName:"INDEX:NKY",title:"NIKKEI 225"},
              {proName:"BITSTAMP:BTCUSD",title:"BTC/USD"},{proName:"FOREXCOM:USDKRW",title:"USD/KRW"},
              {proName:"NYMEX:CL1!",title:"WTI ì›ìœ "},{proName:"COMEX:GC1!",title:"GOLD"}
            ],
            displayMode:"adaptive"
          }}/>
        </div>

        {/* Navigation */}
        <nav style={{height:42,background:T.panel2,borderBottom:`1px solid ${T.border}`,display:"flex",padding:"0 10px",gap:4,alignItems:"center",flexShrink:0}}>
          <button onClick={()=>setTab("world")} className={`btn${tab==="world"?" a":""}`}>ğŸŒ WORLD FLOW MAP</button>
          <button onClick={()=>setTab("chain")} className={`btn${tab==="chain"?" a":""}`}>ğŸ”— MACRO CHAIN</button>
          <button onClick={()=>setTab("hedge")} className={`btn${tab==="hedge"?" a":""}`}>ğŸ’¼ HEDGE FUND TRACKER</button>
          <button onClick={()=>setTab("cal")} className={`btn${tab==="cal"?" a":""}`}>ğŸ“… CALENDAR & NEWS</button>
          <div style={{marginLeft:"auto",display:"flex",alignItems:"center",gap:12}}>
            <span style={{fontSize:9,color:T.dim,fontFamily:"JetBrains Mono"}}>â— SYSTEM STATUS: OPTIMAL</span>
            <div style={{width:6,height:6,borderRadius:"50%",background:T.green,boxShadow:`0 0 8px ${T.green}`}} className="blink"/>
          </div>
        </nav>

        {/* Main Content */}
        <main style={{flex:1,minHeight:0}}>
          {tab==="world"&&<WorldMapView/>}
          {tab==="chain"&&<MacroChainView/>}
          {tab==="hedge"&&<HedgeFundView/>}
          {tab==="cal"&&<CalendarView/>}
        </main>

        {/* Footer */}
        <footer style={{height:24,background:T.panel,borderTop:`1px solid ${T.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 20px",fontSize:8,color:T.dim,fontFamily:"JetBrains Mono",flexShrink:0}}>
          <div>DATA SOURCES: FRED (ST. LOUIS FED), ALPHA VANTAGE, FINNHUB, TRADINGVIEW</div>
          <div>ESTIMATED COMPUTE COST: 0.042 CREDITS/TURN | NODE: SEOUL-1</div>
        </footer>
      </div>
    </LiveCtx.Provider>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
